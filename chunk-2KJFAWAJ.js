import{e as y,f as A,g as P}from"./chunk-FA2YOZ5C.js";import{c as u,f as T}from"./chunk-XAFYO27J.js";import{e as w,f as C}from"./chunk-GDJFI7EY.js";import{e as x,k as F}from"./chunk-HKRXH733.js";import{d as B,j as h}from"./chunk-SO6VPFYA.js";function _(){return h(this,null,function*(){return m||(m=new Promise((r,s)=>{let n,e=null,o={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};import("./chunk-YE2SFYXN.js").then(({ThinEngine:i})=>{try{n=new OffscreenCanvas(100,100),e=new i(n,!1,o)}catch{n=document.createElement("canvas"),e=new i(n,!1,o)}w.Instances.pop(),w.OnEnginesDisposedObservable.add(a=>{e&&a!==e&&!e.isDisposed&&w.Instances.length===0&&b()}),e.getCaps().parallelShaderCompile=void 0;let p=new y(e);import("./chunk-Q5QGWIOH.js").then(({passPixelShader:a})=>{if(!e){s("Engine is not defined");return}let f=new A({engine:e,name:a.name,fragmentShader:a.shader,samplerNames:["textureSampler"]});l={canvas:n,engine:e,renderer:p,wrapper:f},r(l)})}).catch(s)})),yield m})}function E(r,s,n,e,o="image/png",i,p){return h(this,null,function*(){let a=yield n.readPixels(0,0,r,s),f=new Uint8Array(a.buffer);g(r,s,f,e,o,i,!0,void 0,p)})}function S(r,s,n,e="image/png",o,i=!1,p=!1,a){return new Promise(f=>{g(r,s,n,t=>f(t),e,o,i,p,a)})}function g(r,s,n,e,o="image/png",i,p=!1,a=!1,f){_().then(t=>{if(t.engine.setSize(r,s,!0),n instanceof Float32Array){let d=new Uint8Array(n.length),c=n.length;for(;c--;){let D=n[c];d[c]=Math.round(x(D)*255)}n=d}let v=t.engine.createRawTexture(n,r,s,5,!1,!p,1);t.renderer.setViewport(),t.renderer.applyEffectWrapper(t.wrapper),t.wrapper.effect._bindTexture("textureSampler",v),t.renderer.draw(),a?u.ToBlob(t.canvas,d=>{let c=new FileReader;c.onload=D=>{let R=D.target.result;e&&e(R)},c.readAsArrayBuffer(d)},o,f):u.EncodeScreenshotCanvasData(t.canvas,e,o,i,f),v.dispose()})}function b(){l?(l.wrapper.dispose(),l.renderer.dispose(),l.engine.dispose()):m?.then(r=>{r.wrapper.dispose(),r.renderer.dispose(),r.engine.dispose()}),m=null,l=null}var l,m,z,I,O=B(()=>{P();T();F();C();m=null;z={DumpData:g,DumpDataAsync:S,DumpFramebuffer:E,Dispose:b},I=()=>{u.DumpData=g,u.DumpDataAsync=S,u.DumpFramebuffer=E};I()});export{E as a,S as b,g as c,b as d,z as e,O as f};
