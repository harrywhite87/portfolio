import{a as U,b as N}from"./chunk-EAGF4LHA.js";import{a as y,b as K}from"./chunk-BE7GIU5G.js";import{d as F}from"./chunk-SO6VPFYA.js";function w(e,r,t,s){switch(r){case 5120:{let i=e.getInt8(t);return s&&(i=Math.max(i/127,-1)),i}case 5121:{let i=e.getUint8(t);return s&&(i=i/255),i}case 5122:{let i=e.getInt16(t,!0);return s&&(i=Math.max(i/32767,-1)),i}case 5123:{let i=e.getUint16(t,!0);return s&&(i=i/65535),i}case 5124:return e.getInt32(t,!0);case 5125:return e.getUint32(t,!0);case 5126:return e.getFloat32(t,!0);default:throw new Error(`Invalid component type ${r}`)}}function M(e,r,t,s,i){switch(r){case 5120:{s&&(i=Math.round(i*127)),e.setInt8(t,i);break}case 5121:{s&&(i=Math.round(i*255)),e.setUint8(t,i);break}case 5122:{s&&(i=Math.round(i*32767)),e.setInt16(t,i,!0);break}case 5123:{s&&(i=Math.round(i*65535)),e.setUint16(t,i,!0);break}case 5124:{e.setInt32(t,i,!0);break}case 5125:{e.setUint32(t,i,!0);break}case 5126:{e.setFloat32(t,i,!0);break}default:throw new Error(`Invalid component type ${r}`)}}function g(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function E(e,r,t,s,i,n,u,c){let l=new Array(s),a=new Array(s);if(e instanceof Array){let f=r/4,_=t/4;for(let o=0;o<n;o+=s){for(let h=0;h<s;h++)l[h]=a[h]=e[f+h];c(a,o);for(let h=0;h<s;h++)l[h]!==a[h]&&(e[f+h]=a[h]);f+=_}}else{let f=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),_=g(i);for(let o=0;o<n;o+=s){for(let h=0,d=r;h<s;h++,d+=_)l[h]=a[h]=w(f,i,d,u);c(a,o);for(let h=0,d=r;h<s;h++,d+=_)l[h]!==a[h]&&M(f,i,d,u,a[h]);r+=t}}}function S(e,r,t,s,i,n,u,c){let l=r*g(t),a=u*r;if(t!==5126||i!==l){let f=new Float32Array(a);return E(e,s,i,r,t,a,n,(_,o)=>{for(let h=0;h<r;h++)f[o+h]=_[h]}),f}if(!(e instanceof Array||e instanceof Float32Array)||s!==0||e.length!==a)if(e instanceof Array){let f=s/4;return e.slice(f,f+a)}else{if(e instanceof ArrayBuffer)return new Float32Array(e,s,a);{let f=e.byteOffset+s;return f&3&&(y.Warn("Float array must be aligned to 4-bytes border"),c=!0),c?new Float32Array(e.buffer.slice(f,f+a*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,f,a)}}return c?e.slice():e}function G(e,r,t,s,i,n,u,c){let l=r*g(t),a=u*r;if(c.length!==a)throw new Error("Output length is not valid");if(t!==5126||i!==l){E(e,s,i,r,t,a,n,(f,_)=>{for(let o=0;o<r;o++)c[_+o]=f[o]});return}if(e instanceof Array){let f=s/4;c.set(e,f)}else if(e instanceof ArrayBuffer){let f=new Float32Array(e,s,a);c.set(f)}else{let f=e.byteOffset+s;if(f&3){y.Warn("Float array must be aligned to 4-bytes border"),c.set(new Float32Array(e.buffer.slice(f,f+a*Float32Array.BYTES_PER_ELEMENT)));return}let _=new Float32Array(e.buffer,f,a);c.set(_)}}function R(e,r){return e?e instanceof Array?e.some(t=>t>=65536):e.BYTES_PER_ELEMENT===4:r>=65536}var m=F(()=>{"use strict";K()});var D,p,L=F(()=>{"use strict";N();K();m();D=class{get isDisposed(){return this._isDisposed}constructor(r,t,s,i=0,n=!1,u=!1,c=!1,l,a){this._isAlreadyOwned=!1,this._isDisposed=!1,r&&r.getScene?this._engine=r.getScene().getEngine():this._engine=r,this._updatable=s,this._instanced=u,this._divisor=l||1,this._label=a,t instanceof U?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=c?i:i*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(r,t,s,i,n,u=!1,c){let l=u?t:t*Float32Array.BYTES_PER_ELEMENT,a=i?u?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new p(this._engine,this,r,this._updatable,!0,a,n===void 0?this._instanced:n,l,s,void 0,void 0,!0,this._divisor||c)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(r=null){!r&&this._buffer||(r=r||this._data,r&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,r),this._data=r):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(r,this._label),this._data=r):this._buffer=this._engine.createVertexBuffer(r,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}y.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(r){this.create(r)}updateDirectly(r,t,s,i=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,r,i?t:t*Float32Array.BYTES_PER_ELEMENT,s?s*this.byteStride:void 0),t===0&&s===void 0?this._data=r:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}},p=(()=>{class e{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){let s=t!=0;this._instanceDivisor=t,s!==this._instanced&&(this._instanced=s,this._computeHashCode())}get _maxVerticesCount(){let t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}constructor(t,s,i,n,u,c,l,a,f,_,o=!1,h=!1,d=1,A=!1){this._isDisposed=!1;let I=!1;if(this.engine=t,typeof n=="object"&&n!==null?(I=n.updatable??!1,u=n.postponeInternalCreation,c=n.stride,l=n.instanced,a=n.offset,f=n.size,_=n.type,o=n.normalized??!1,h=n.useBytes??!1,d=n.divisor??1,A=n.takeBufferOwnership??!1,this._label=n.label):I=!!n,s instanceof D?(this._buffer=s,this._ownsBuffer=A):(this._buffer=new D(t,s,I,c,u,l,h,d,this._label),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=i,_===void 0){let T=this.getData();this.type=T?e.GetDataType(T):e.FLOAT}else this.type=_;let b=g(this.type);h?(this._size=f||(c?c/b:e.DeduceStride(i)),this.byteStride=c||this._buffer.byteStride||this._size*b,this.byteOffset=a||0):(this._size=f||c||e.DeduceStride(i),this.byteStride=c?c*b:this._buffer.byteStride||this._size*b,this.byteOffset=(a||0)*b),this.normalized=o,this._instanced=l!==void 0?l:!1,this._instanceDivisor=l?d:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,s){let i=this.getData();return i?S(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,s):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/g(this.type)}getOffset(){return this.byteOffset/g(this.type)}getSize(t=!1){return t?this._size*g(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t),this._alignBuffer()}update(t){this._buffer.update(t),this._alignBuffer()}updateDirectly(t,s,i=!1){this._buffer.updateDirectly(t,s,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(t,s){E(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,(i,n)=>{for(let u=0;u<this._size;u++)s(i[u],n+u)})}_alignBuffer(){}static DeduceStride(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetDataType(t){return t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int16Array?e.SHORT:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int32Array?e.INT:t instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static GetTypeByteLength(t){return g(t)}static ForEach(t,s,i,n,u,c,l,a){E(t,s,i,n,u,c,l,(f,_)=>{for(let o=0;o<n;o++)a(f[o],_+o)})}static GetFloatData(t,s,i,n,u,c,l,a){return S(t,s,i,n,u,c,l,a)}}return e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e})()});export{g as a,E as b,S as c,G as d,R as e,m as f,D as g,p as h,L as i};
