import{T as dt,U as St}from"./chunk-YFA33DOZ.js";import{c as z,d as vt,g as k,h as Et,i as U,j as mt}from"./chunk-DNG3AX6D.js";import{a as F,b as E,d as Nt,e as V,f as Rt,j as D,x as xt}from"./chunk-IYNELJD3.js";import{f as q,h as Mt,i as C,j as y,l as b,m as A,n as I,o as w}from"./chunk-W427QTGG.js";import{d as j,e as Pt}from"./chunk-MME3KDWL.js";import{ba as lt,ca as yt,k as rt,l as Ot}from"./chunk-BKKMM5NX.js";import{a as ut,d as It}from"./chunk-QY4EALXS.js";import{c as v,d as X,e as W,f as ot}from"./chunk-GDJFI7EY.js";import{c as ht,d as ct,k as bt}from"./chunk-HKRXH733.js";import{d as S}from"./chunk-SO6VPFYA.js";var B,ft=S(()=>{"use strict";B=class r{constructor(t,e,i){this.name=t,this.from=e,this.to=i}clone(){return new r(this.name,this.from,this.to)}}});var Z,R,J=S(()=>{"use strict";Rt();w();xt();X();ot();Ot();mt();Z=class{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new v,this._onClonedObservable=new v}},R=class r{static AddNodeConstructor(t,e){this._NodeConstructors[t]=e}static Construct(t,e,i,n){let s=this._NodeConstructors[t];return s?s(e,i,n):null}set accessibilityTag(t){this._accessibilityTag=t,this.onAccessibilityTagChangedObservable.notifyObservers(t)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return this._nodeDataStorage._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1}set doNotSerialize(t){this._nodeDataStorage._doNotSerialize=t}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(t){if(this._parentNode===t)return;let e=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){let i=this._parentNode._children.indexOf(this);i!==-1&&this._parentNode._children.splice(i,1),!t&&!this._nodeDataStorage._isDisposed&&this._addToSceneRootNodes()}this._parentNode=t,this._isDirty=!0,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),e||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(t){t.parentId=this.uniqueId}_addToSceneRootNodes(){this._nodeDataStorage._sceneRootNodesIndex===-1&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(this._nodeDataStorage._sceneRootNodesIndex!==-1){let t=this._scene.rootNodes,e=t.length-1;t[this._nodeDataStorage._sceneRootNodesIndex]=t[e],t[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}getClassName(){return"Node"}set onDispose(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(t,e=null,i=!0){this._isDirty=!1,this._nodeDataStorage=new Z,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new v,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=A.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new v,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=e||W.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(t,e=!1){return this._behaviors.indexOf(t)!==-1?this:(t.init(),this._scene.isLoading&&!e?this._scene.onDataLoadedObservable.addOnce(()=>{t.attach(this)}):t.attach(this),this._behaviors.push(t),this)}removeBehavior(t){let e=this._behaviors.indexOf(t);return e===-1?this:(this._behaviors[e].detach(),this._behaviors.splice(e,1),this)}get behaviors(){return this._behaviors}getBehaviorByName(t){for(let e of this._behaviors)if(e.name===t)return e;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(t){!t&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(t,e=!0){return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_updateCache(t){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return this._parentNode?this._parentNode._isDirty||this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0}isSynchronized(){return this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()}isReady(t=!1){return this._nodeDataStorage._isReady}markAsDirty(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(t=!0){return t===!1?this._nodeDataStorage._isEnabled:this._nodeDataStorage._isEnabled?this._nodeDataStorage._isParentEnabled:!1}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(t=>{t._syncParentEnabledState()})}setEnabled(t){this._nodeDataStorage._isEnabled!==t&&(this._nodeDataStorage._isEnabled=t,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(t))}isDescendantOf(t){return this.parent?this.parent===t?!0:this.parent.isDescendantOf(t):!1}_getDescendants(t,e=!1,i){if(this._children)for(let n=0;n<this._children.length;n++){let s=this._children[n];(!i||i(s))&&t.push(s),e||s._getDescendants(t,!1,i)}}getDescendants(t,e){let i=[];return this._getDescendants(i,t,e),i}getChildMeshes(t,e){let i=[];return this._getDescendants(i,t,n=>(!e||e(n))&&n.cullingStrategy!==void 0),i}getChildren(t,e=!0){return this.getDescendants(e,t)}_setReady(t){if(t!==this._nodeDataStorage._isReady){if(!t){this._nodeDataStorage._isReady=!1;return}this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0}}getAnimationByName(t){for(let e=0;e<this.animations.length;e++){let i=this.animations[e];if(i.name===t)return i}return null}createAnimationRange(t,e,i){if(!this._ranges[t]){this._ranges[t]=r._AnimationRangeFactory(t,e,i);for(let n=0,s=this.animations.length;n<s;n++)this.animations[n]&&this.animations[n].createRange(t,e,i)}}deleteAnimationRange(t,e=!0){for(let i=0,n=this.animations.length;i<n;i++)this.animations[i]&&this.animations[i].deleteRange(t,e);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}clone(t,e,i){let n=U.Clone(()=>new r(t,this.getScene()),this);if(e&&(n.parent=e),!i){let s=this.getDescendants(!0);for(let a=0;a<s.length;a++){let o=s[a];o.clone(t+"."+o.name,n)}}return n}getAnimationRanges(){let t=[],e;for(e in this._ranges)t.push(this._ranges[e]);return t}beginAnimation(t,e,i,n){let s=this.getAnimationRange(t);return s?this._scene.beginAnimation(this,s.from,s.to,e,i,n):null}serializeAnimationRanges(){let t=[];for(let e in this._ranges){let i=this._ranges[e];if(!i)continue;let n={};n.name=e,n.from=i.from,n.to=i.to,t.push(n)}return t}computeWorldMatrix(t){return this._worldMatrix||(this._worldMatrix=A.Identity()),this._worldMatrix}dispose(t,e=!1){if(this._nodeDataStorage._isDisposed=!0,!t){let i=this.getDescendants(!0);for(let n of i)n.dispose(t,e)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(let i of this._behaviors)i.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(t,e,i){if(e.ranges)for(let n=0;n<e.ranges.length;n++){let s=e.ranges[n];t.createAnimationRange(s.name,s.from,s.to)}}getHierarchyBoundingVectors(t=!0,e=null){this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);let i,n,s=this;if(s.getBoundingInfo&&s.subMeshes){let a=s.getBoundingInfo();i=a.boundingBox.minimumWorld.clone(),n=a.boundingBox.maximumWorld.clone()}else i=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(t){let a=this.getDescendants(!1);for(let o of a){let l=o;if(l.computeWorldMatrix(!0),e&&!e(l)||!l.getBoundingInfo||l.getTotalVertices()===0)continue;let c=l.getBoundingInfo().boundingBox,m=c.minimumWorld,d=c.maximumWorld;y.CheckExtends(m,i,n),y.CheckExtends(d,i,n)}}return{min:i,max:n}}};R._AnimationRangeFactory=(r,t,e)=>{throw rt("AnimationRange")};R._NodeConstructors={};V([D()],R.prototype,"name",void 0);V([D()],R.prototype,"id",void 0);V([D()],R.prototype,"uniqueId",void 0);V([D()],R.prototype,"state",void 0);V([D()],R.prototype,"metadata",void 0)});var $,G,tt,et,it,nt,P,g,K=S(()=>{"use strict";w();Nt();bt();It();ft();J();vt();Pt();mt();$=Object.freeze(new b(0,0,0,0)),G=Object.freeze(y.Zero()),tt=Object.freeze(C.Zero()),et=Object.freeze(z.Zero()),it=Object.freeze(F.Black()),nt=Object.freeze(new E(0,0,0,0)),P={key:0,repeatCount:0,loopMode:2},g=class r{static _PrepareAnimation(t,e,i,n,s,a,o,l){let h;if(!isNaN(parseFloat(s))&&isFinite(s)?h=r.ANIMATIONTYPE_FLOAT:s instanceof b?h=r.ANIMATIONTYPE_QUATERNION:s instanceof y?h=r.ANIMATIONTYPE_VECTOR3:s instanceof C?h=r.ANIMATIONTYPE_VECTOR2:s instanceof F?h=r.ANIMATIONTYPE_COLOR3:s instanceof E?h=r.ANIMATIONTYPE_COLOR4:s instanceof z&&(h=r.ANIMATIONTYPE_SIZE),h==null)return null;let c=new r(t,e,i,h,o),m=[{frame:0,value:s},{frame:n,value:a}];return c.setKeys(m),l!==void 0&&c.setEasingFunction(l),c}static CreateAnimation(t,e,i,n){let s=new r(t+"Animation",t,i,e,r.ANIMATIONLOOPMODE_CONSTANT);return s.setEasingFunction(n),s}static CreateAndStartAnimation(t,e,i,n,s,a,o,l,h,c,m){let d=r._PrepareAnimation(t,i,n,s,a,o,l,h);return!d||(e.getScene&&(m=e.getScene()),!m)?null:m.beginDirectAnimation(e,[d],0,s,d.loopMode!==r.ANIMATIONLOOPMODE_CONSTANT,1,c)}static CreateAndStartHierarchyAnimation(t,e,i,n,s,a,o,l,h,c,m){let d=r._PrepareAnimation(t,n,s,a,o,l,h,c);return d?e.getScene().beginDirectHierarchyAnimation(e,i,[d],0,a,d.loopMode===1,1,m):null}static CreateMergeAndStartAnimation(t,e,i,n,s,a,o,l,h,c){let m=r._PrepareAnimation(t,i,n,s,a,o,l,h);return m?(e.animations.push(m),e.getScene().beginAnimation(e,0,s,m.loopMode===1,1,c)):null}static MakeAnimationAdditive(t,e,i,n=!1,s){let a;typeof e=="object"?a=e:a={referenceFrame:e??0,range:i,cloneOriginalAnimation:n,clonedAnimationName:s};let o=t;if(a.cloneOriginalAnimation&&(o=t.clone(),o.name=a.clonedAnimationName||o.name),!o._keys.length)return o;let l=a.referenceFrame&&a.referenceFrame>=0?a.referenceFrame:0,h=0,c=o._keys[0],m=o._keys.length-1,d=o._keys[m],u={referenceValue:c.value,referencePosition:I.Vector3[0],referenceQuaternion:I.Quaternion[0],referenceScaling:I.Vector3[1],keyPosition:I.Vector3[2],keyQuaternion:I.Quaternion[1],keyScaling:I.Vector3[3]},p=c.frame,f=d.frame;if(a.range){let T=o.getRange(a.range);T&&(p=T.from,f=T.to)}else p=a.fromFrame??p,f=a.toFrame??f;if(p!==c.frame&&(h=o.createKeyForFrame(p)),f!==d.frame&&(m=o.createKeyForFrame(f)),o._keys.length===1){let T=o._getKeyValue(o._keys[0]);u.referenceValue=T.clone?T.clone():T}else if(l<=c.frame){let T=o._getKeyValue(c.value);u.referenceValue=T.clone?T.clone():T}else if(l>=d.frame){let T=o._getKeyValue(d.value);u.referenceValue=T.clone?T.clone():T}else{P.key=0;let T=o._interpolate(l,P);u.referenceValue=T.clone?T.clone():T}o.dataType===r.ANIMATIONTYPE_QUATERNION?u.referenceValue.normalize().conjugateInPlace():o.dataType===r.ANIMATIONTYPE_MATRIX&&(u.referenceValue.decompose(u.referenceScaling,u.referenceQuaternion,u.referencePosition),u.referenceQuaternion.normalize().conjugateInPlace());let O=Number.MAX_VALUE,N=a.clipKeys?[]:null;for(let T=h;T<=m;T++){let _=o._keys[T];if((N||a.cloneOriginalAnimation)&&(_={frame:_.frame,value:_.value.clone?_.value.clone():_.value,inTangent:_.inTangent,outTangent:_.outTangent,interpolation:_.interpolation,lockedTangent:_.lockedTangent},N&&(O===Number.MAX_VALUE&&(O=_.frame),_.frame-=O,N.push(_))),!(T&&o.dataType!==r.ANIMATIONTYPE_FLOAT&&_.value===c.value))switch(o.dataType){case r.ANIMATIONTYPE_MATRIX:_.value.decompose(u.keyScaling,u.keyQuaternion,u.keyPosition),u.keyPosition.subtractInPlace(u.referencePosition),u.keyScaling.divideInPlace(u.referenceScaling),u.referenceQuaternion.multiplyToRef(u.keyQuaternion,u.keyQuaternion),A.ComposeToRef(u.keyScaling,u.keyQuaternion,u.keyPosition,_.value);break;case r.ANIMATIONTYPE_QUATERNION:u.referenceValue.multiplyToRef(_.value,_.value);break;case r.ANIMATIONTYPE_VECTOR2:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:_.value.subtractToRef(u.referenceValue,_.value);break;case r.ANIMATIONTYPE_SIZE:_.value.width-=u.referenceValue.width,_.value.height-=u.referenceValue.height;break;default:_.value-=u.referenceValue}}return N&&o.setKeys(N,!0),o}static TransitionTo(t,e,i,n,s,a,o,l=null){if(o<=0)return i[t]=e,l&&l(),null;let h=s*(o/1e3);a.setKeys([{frame:0,value:i[t].clone?i[t].clone():i[t]},{frame:h,value:e}]),i.animations||(i.animations=[]),i.animations.push(a);let c=n.beginAnimation(i,0,h,!1);return c.onAnimationEnd=l,c}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(let t of this._runtimeAnimations)if(!t.isStopped())return!0;return!1}constructor(t,e,i,n,s,a){this.name=t,this.targetProperty=e,this.framePerSecond=i,this.dataType=n,this.loopMode=s,this.enableBlending=a,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=n,this.loopMode=s===void 0?r.ANIMATIONLOOPMODE_CYCLE:s,this.uniqueId=r._UniqueIdGenerator++}toString(t){let e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";let i=!0;for(let n in this._ranges)i&&(e+=", ",i=!1),e+=n;e+="}"}return e}addEvent(t){this._events.push(t),this._events.sort((e,i)=>e.frame-i.frame)}removeEvents(t){for(let e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)}getEvents(){return this._events}createRange(t,e,i){this._ranges[t]||(this._ranges[t]=new B(t,e,i))}deleteRange(t,e=!0){let i=this._ranges[t];if(i){if(e){let n=i.from,s=i.to;for(let a=this._keys.length-1;a>=0;a--)this._keys[a].frame>=n&&this._keys[a].frame<=s&&this._keys.splice(a,1)}this._ranges[t]=null}}getRange(t){return this._ranges[t]}getKeys(){return this._keys}getHighestFrame(){let t=0;for(let e=0,i=this._keys.length;e<i;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t}getEasingFunction(){return this._easingFunction}setEasingFunction(t){this._easingFunction=t}floatInterpolateFunction(t,e,i){return ht(t,e,i)}floatInterpolateFunctionWithTangents(t,e,i,n,s){return ct(t,e,i,n,s)}quaternionInterpolateFunction(t,e,i){return b.Slerp(t,e,i)}quaternionInterpolateFunctionWithTangents(t,e,i,n,s){return b.Hermite(t,e,i,n,s).normalize()}vector3InterpolateFunction(t,e,i){return y.Lerp(t,e,i)}vector3InterpolateFunctionWithTangents(t,e,i,n,s){return y.Hermite(t,e,i,n,s)}vector2InterpolateFunction(t,e,i){return C.Lerp(t,e,i)}vector2InterpolateFunctionWithTangents(t,e,i,n,s){return C.Hermite(t,e,i,n,s)}sizeInterpolateFunction(t,e,i){return z.Lerp(t,e,i)}color3InterpolateFunction(t,e,i){return F.Lerp(t,e,i)}color3InterpolateFunctionWithTangents(t,e,i,n,s){return F.Hermite(t,e,i,n,s)}color4InterpolateFunction(t,e,i){return E.Lerp(t,e,i)}color4InterpolateFunctionWithTangents(t,e,i,n,s){return E.Hermite(t,e,i,n,s)}_getKeyValue(t){return typeof t=="function"?t():t}evaluate(t){return P.key=0,this._interpolate(t,P)}_interpolate(t,e,i=!1){if(e.loopMode===r.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;let n=this._keys,s=n.length,a=e.key;for(;a>=0&&t<n[a].frame;)--a;for(;a+1<=s-1&&t>=n[a+1].frame;)++a;if(e.key=a,a<0)return i?void 0:this._getKeyValue(n[0].value);if(a+1>s-1)return i?void 0:this._getKeyValue(n[s-1].value);let o=n[a],l=n[a+1];if(i&&(t===o.frame||t===l.frame))return;let h=this._getKeyValue(o.value),c=this._getKeyValue(l.value);if(o.interpolation===1)return l.frame>t?h:c;let m=o.outTangent!==void 0&&l.inTangent!==void 0,d=l.frame-o.frame,u=(t-o.frame)/d,p=o.easingFunction||this.getEasingFunction();switch(p!==null&&(u=p.ease(u)),this.dataType){case r.ANIMATIONTYPE_FLOAT:{let f=m?this.floatInterpolateFunctionWithTangents(h,o.outTangent*d,c,l.inTangent*d,u):this.floatInterpolateFunction(h,c,u);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return f;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(e.offsetValue??0)*e.repeatCount+f}break}case r.ANIMATIONTYPE_QUATERNION:{let f=m?this.quaternionInterpolateFunctionWithTangents(h,o.outTangent.scale(d),c,l.inTangent.scale(d),u):this.quaternionInterpolateFunction(h,c,u);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return f;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.addInPlace((e.offsetValue||$).scale(e.repeatCount))}return f}case r.ANIMATIONTYPE_VECTOR3:{let f=m?this.vector3InterpolateFunctionWithTangents(h,o.outTangent.scale(d),c,l.inTangent.scale(d),u):this.vector3InterpolateFunction(h,c,u);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return f;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((e.offsetValue||G).scale(e.repeatCount))}break}case r.ANIMATIONTYPE_VECTOR2:{let f=m?this.vector2InterpolateFunctionWithTangents(h,o.outTangent.scale(d),c,l.inTangent.scale(d),u):this.vector2InterpolateFunction(h,c,u);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return f;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((e.offsetValue||tt).scale(e.repeatCount))}break}case r.ANIMATIONTYPE_SIZE:{switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(h,c,u);case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(h,c,u).add((e.offsetValue||et).scale(e.repeatCount))}break}case r.ANIMATIONTYPE_COLOR3:{let f=m?this.color3InterpolateFunctionWithTangents(h,o.outTangent.scale(d),c,l.inTangent.scale(d),u):this.color3InterpolateFunction(h,c,u);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return f;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((e.offsetValue||it).scale(e.repeatCount))}break}case r.ANIMATIONTYPE_COLOR4:{let f=m?this.color4InterpolateFunctionWithTangents(h,o.outTangent.scale(d),c,l.inTangent.scale(d),u):this.color4InterpolateFunction(h,c,u);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return f;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((e.offsetValue||nt).scale(e.repeatCount))}break}case r.ANIMATIONTYPE_MATRIX:{switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return r.AllowMatricesInterpolation?this.matrixInterpolateFunction(h,c,u,e.workValue):h;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h}break}}return 0}matrixInterpolateFunction(t,e,i,n){return r.AllowMatrixDecomposeForInterpolation?n?(A.DecomposeLerpToRef(t,e,i,n),n):A.DecomposeLerp(t,e,i):n?(A.LerpToRef(t,e,i,n),n):A.Lerp(t,e,i)}clone(){let t=new r(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(let e in this._ranges){let i=this._ranges[e];i&&(t._ranges[e]=i.clone())}}return t}setKeys(t,e=!1){this._keys=e?t:t.slice(0)}createKeyForFrame(t){P.key=0;let e=this._interpolate(t,P,!0);if(!e)return this._keys[P.key].frame===t?P.key:P.key+1;let i={frame:t,value:e.clone?e.clone():e};return this._keys.splice(P.key+1,0,i),P.key+1}serialize(){let t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;let e=this.dataType;t.keys=[];let i=this.getKeys();for(let n=0;n<i.length;n++){let s=i[n],a={};switch(a.frame=s.frame,e){case r.ANIMATIONTYPE_FLOAT:a.values=[s.value],s.inTangent!==void 0&&a.values.push(s.inTangent),s.outTangent!==void 0&&(s.inTangent===void 0&&a.values.push(void 0),a.values.push(s.outTangent)),s.interpolation!==void 0&&(s.inTangent===void 0&&a.values.push(void 0),s.outTangent===void 0&&a.values.push(void 0),a.values.push(s.interpolation));break;case r.ANIMATIONTYPE_QUATERNION:case r.ANIMATIONTYPE_MATRIX:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:a.values=s.value.asArray(),s.inTangent!=null&&a.values.push(s.inTangent.asArray()),s.outTangent!=null&&(s.inTangent===void 0&&a.values.push(void 0),a.values.push(s.outTangent.asArray())),s.interpolation!==void 0&&(s.inTangent===void 0&&a.values.push(void 0),s.outTangent===void 0&&a.values.push(void 0),a.values.push(s.interpolation));break}t.keys.push(a)}t.ranges=[];for(let n in this._ranges){let s=this._ranges[n];if(!s)continue;let a={};a.name=n,a.from=s.from,a.to=s.to,t.ranges.push(a)}return t}static _UniversalLerp(t,e,i){let n=t.constructor;return n.Lerp?n.Lerp(t,e,i):n.Slerp?n.Slerp(t,e,i):t.toFixed?t*(1-i)+i*e:e}static Parse(t){let e=new r(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),i=t.dataType,n=[],s,a;for(t.enableBlending&&(e.enableBlending=t.enableBlending),t.blendingSpeed&&(e.blendingSpeed=t.blendingSpeed),a=0;a<t.keys.length;a++){let o=t.keys[a],l,h,c;switch(i){case r.ANIMATIONTYPE_FLOAT:s=o.values[0],o.values.length>=2&&(l=o.values[1]),o.values.length>=3&&(h=o.values[2]),o.values.length>=4&&(c=o.values[3]);break;case r.ANIMATIONTYPE_QUATERNION:if(s=b.FromArray(o.values),o.values.length>=8){let d=b.FromArray(o.values.slice(4,8));d.equals(b.Zero())||(l=d)}if(o.values.length>=12){let d=b.FromArray(o.values.slice(8,12));d.equals(b.Zero())||(h=d)}o.values.length>=13&&(c=o.values[12]);break;case r.ANIMATIONTYPE_MATRIX:s=A.FromArray(o.values),o.values.length>=17&&(c=o.values[16]);break;case r.ANIMATIONTYPE_COLOR3:s=F.FromArray(o.values),o.values[3]&&(l=F.FromArray(o.values[3])),o.values[4]&&(h=F.FromArray(o.values[4])),o.values[5]&&(c=o.values[5]);break;case r.ANIMATIONTYPE_COLOR4:s=E.FromArray(o.values),o.values[4]&&(l=E.FromArray(o.values[4])),o.values[5]&&(h=E.FromArray(o.values[5])),o.values[6]&&(c=E.FromArray(o.values[6]));break;case r.ANIMATIONTYPE_VECTOR3:default:s=y.FromArray(o.values),o.values[3]&&(l=y.FromArray(o.values[3])),o.values[4]&&(h=y.FromArray(o.values[4])),o.values[5]&&(c=o.values[5]);break}let m={};m.frame=o.frame,m.value=s,l!=null&&(m.inTangent=l),h!=null&&(m.outTangent=h),c!=null&&(m.interpolation=c),n.push(m)}if(e.setKeys(n),t.ranges)for(a=0;a<t.ranges.length;a++)s=t.ranges[a],e.createRange(s.name,s.from,s.to);return e}static AppendSerializedAnimations(t,e){U.AppendSerializedAnimations(t,e)}static ParseFromFileAsync(t,e){return new Promise((i,n)=>{let s=new j;s.addEventListener("readystatechange",()=>{if(s.readyState==4)if(s.status==200){let a=JSON.parse(s.responseText);if(a.animations&&(a=a.animations),a.length){let o=[];for(let l of a)o.push(this.Parse(l));i(o)}else{let o=this.Parse(a);t&&(o.name=t),i(o)}}else n("Unable to load the animation")}),s.open("GET",e),s.send()})}static ParseFromSnippetAsync(t){return new Promise((e,i)=>{let n=new j;n.addEventListener("readystatechange",()=>{if(n.readyState==4)if(n.status==200){let s=JSON.parse(JSON.parse(n.responseText).jsonPayload);if(s.animations){let a=JSON.parse(s.animations),o=[];for(let l of a.animations){let h=this.Parse(l);h.snippetId=t,o.push(h)}e(o)}else{let a=JSON.parse(s.animation),o=this.Parse(a);o.snippetId=t,e(o)}}else i("Unable to load the snippet "+t)}),n.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),n.send()})}};g._UniqueIdGenerator=0;g.AllowMatricesInterpolation=!1;g.AllowMatrixDecomposeForInterpolation=!0;g.SnippetUrl="https://snippet.babylonjs.com";g.ANIMATIONTYPE_FLOAT=0;g.ANIMATIONTYPE_VECTOR3=1;g.ANIMATIONTYPE_QUATERNION=2;g.ANIMATIONTYPE_MATRIX=3;g.ANIMATIONTYPE_COLOR3=4;g.ANIMATIONTYPE_COLOR4=7;g.ANIMATIONTYPE_VECTOR2=5;g.ANIMATIONTYPE_SIZE=6;g.ANIMATIONLOOPMODE_RELATIVE=0;g.ANIMATIONLOOPMODE_CYCLE=1;g.ANIMATIONLOOPMODE_CONSTANT=2;g.ANIMATIONLOOPMODE_YOYO=4;g.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5;g.CreateFromSnippetAsync=g.ParseFromSnippetAsync;ut("BABYLON.Animation",g);R._AnimationRangeFactory=(r,t,e)=>new B(r,t,e)});var L,_t=S(()=>{"use strict";w();Mt();J();L=class r extends R{get _matrix(){return this._compose(),this._localMatrix}set _matrix(t){t.updateFlag===this._localMatrix.updateFlag&&!this._needToCompose||(this._needToCompose=!1,this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose())}constructor(t,e,i=null,n=null,s=null,a=null,o=null){super(t,e.getScene(),!1),this.name=t,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=e,this._localMatrix=n?.clone()??A.Identity(),this._restMatrix=s??this._localMatrix.clone(),this._bindMatrix=a??this._localMatrix.clone(),this._index=o,this._absoluteMatrix=new A,this._absoluteBindMatrix=new A,this._absoluteInverseBindMatrix=new A,this._finalMatrix=new A,e.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index}set parent(t){this.setParent(t)}setParent(t,e=!0){if(this.parent!==t){if(this.parent){let i=this.parent.children.indexOf(this);i!==-1&&this.parent.children.splice(i,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),e&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}getLocalMatrix(){return this._compose(),this._localMatrix}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(t){this._restMatrix.copyFrom(t)}setRestPose(t){this.setRestMatrix(t)}getBindPose(){return this.getBindMatrix()}setBindMatrix(t){this.updateMatrix(t)}setBindPose(t){this.setBindMatrix(t)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){let t=I.Vector3[0],e=I.Quaternion[0],i=I.Vector3[1];this.getRestMatrix().decompose(t,e,i),this._linkedTransformNode.position.copyFrom(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??b.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(e),this._linkedTransformNode.scaling.copyFrom(t)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._localPosition}set position(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(t){this.setRotationQuaternion(t)}get scaling(){return this.getScale()}set scaling(t){this.setScale(t)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=y.Zero(),this._localRotation=b.Zero(),this._localPosition=y.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}_compose(){if(this._needToCompose){if(!this._localScaling){this._needToCompose=!1;return}this._needToCompose=!1,A.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)}}updateMatrix(t,e=!0,i=!0){this._bindMatrix.copyFrom(t),e&&this._updateAbsoluteBindMatrices(),i?this._matrix=t:this.markAsDirty()}_updateAbsoluteBindMatrices(t,e=!0){if(t||(t=this._bindMatrix),this.parent?t.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(t),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),e)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}_updatePosition(t,e=0,i,n=!0){let s=this.getLocalMatrix();if(e==0)n?(s.addAtIndex(12,t.x),s.addAtIndex(13,t.y),s.addAtIndex(14,t.z)):s.setTranslationFromFloats(t.x,t.y,t.z);else{let a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let o=r._TmpMats[0],l=r._TmpVecs[0];this.parent?i&&a?(o.copyFrom(this.parent.getAbsoluteMatrix()),o.multiplyToRef(a,o)):o.copyFrom(this.parent.getAbsoluteMatrix()):A.IdentityToRef(o),n&&o.setTranslationFromFloats(0,0,0),o.invert(),y.TransformCoordinatesToRef(t,o,l),n?(s.addAtIndex(12,l.x),s.addAtIndex(13,l.y),s.addAtIndex(14,l.z)):s.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()}translate(t,e=0,i){this._updatePosition(t,e,i,!0)}setPosition(t,e=0,i){this._updatePosition(t,e,i,!1)}setAbsolutePosition(t,e){this.setPosition(t,1,e)}scale(t,e,i,n=!1){let s=this.getLocalMatrix(),a=r._TmpMats[0];A.ScalingToRef(t,e,i,a),a.multiplyToRef(s,s),a.invert();for(let o of this.children){let l=o.getLocalMatrix();l.multiplyToRef(a,l),l.multiplyAtIndex(12,t),l.multiplyAtIndex(13,e),l.multiplyAtIndex(14,i),o._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),n)for(let o of this.children)o.scale(t,e,i,n)}setScale(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(t){this._decompose(),t.copyFrom(this._localScaling)}setYawPitchRoll(t,e,i,n=0,s){if(n===0){let l=r._TmpQuat;b.RotationYawPitchRollToRef(t,e,i,l),this.setRotationQuaternion(l,n,s);return}let a=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,s))return;let o=r._TmpMats[1];A.RotationYawPitchRollToRef(t,e,i,o),a.multiplyToRef(o,o),this._rotateWithMatrix(o,n,s)}rotate(t,e,i=0,n){let s=r._TmpMats[0];s.setTranslationFromFloats(0,0,0),A.RotationAxisToRef(t,e,s),this._rotateWithMatrix(s,i,n)}setAxisAngle(t,e,i=0,n){if(i===0){let o=r._TmpQuat;b.RotationAxisToRef(t,e,o),this.setRotationQuaternion(o,i,n);return}let s=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,n))return;let a=r._TmpMats[1];A.RotationAxisToRef(t,e,a),s.multiplyToRef(a,a),this._rotateWithMatrix(a,i,n)}setRotation(t,e=0,i){this.setYawPitchRoll(t.y,t.x,t.z,e,i)}setRotationQuaternion(t,e=0,i){if(e===0){this._decompose(),this._localRotation.copyFrom(t),this._markAsDirtyAndCompose();return}let n=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,i))return;let s=r._TmpMats[1];A.FromQuaternionToRef(t,s),n.multiplyToRef(s,s),this._rotateWithMatrix(s,e,i)}setRotationMatrix(t,e=0,i){if(e===0){let a=r._TmpQuat;b.FromRotationMatrixToRef(t,a),this.setRotationQuaternion(a,e,i);return}let n=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,i))return;let s=r._TmpMats[1];s.copyFrom(t),n.multiplyToRef(t,s),this._rotateWithMatrix(s,e,i)}_rotateWithMatrix(t,e=0,i){let n=this.getLocalMatrix(),s=n.m[12],a=n.m[13],o=n.m[14],l=this.getParent(),h=r._TmpMats[3],c=r._TmpMats[4];l&&e==1?(i?(h.copyFrom(i.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(h,h)):h.copyFrom(l.getAbsoluteMatrix()),c.copyFrom(h),c.invert(),n.multiplyToRef(h,n),n.multiplyToRef(t,n),n.multiplyToRef(c,n)):e==1&&i?(h.copyFrom(i.getWorldMatrix()),c.copyFrom(h),c.invert(),n.multiplyToRef(h,n),n.multiplyToRef(t,n),n.multiplyToRef(c,n)):n.multiplyToRef(t,n),n.setTranslationFromFloats(s,a,o),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(t,e){let i=r._TmpMats[2];return t.copyFrom(this.getAbsoluteMatrix()),e?(t.multiplyToRef(e.getWorldMatrix(),t),A.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,i)):A.IdentityToRef(i),t.invert(),isNaN(t.m[0])?!1:(i.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(i,t),!0)}getPosition(t=0,e=null){let i=y.Zero();return this.getPositionToRef(t,e,i),i}getPositionToRef(t=0,e,i){if(t==0){let n=this.getLocalMatrix();i.x=n.m[12],i.y=n.m[13],i.z=n.m[14]}else{let n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=r._TmpMats[0];e&&n?(s.copyFrom(this.getAbsoluteMatrix()),s.multiplyToRef(n,s)):s=this.getAbsoluteMatrix(),i.x=s.m[12],i.y=s.m[13],i.z=s.m[14]}}getAbsolutePosition(t=null){let e=y.Zero();return this.getPositionToRef(1,t,e),e}getAbsolutePositionToRef(t,e){this.getPositionToRef(1,t,e)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);let i=this._skeleton.getPoseMatrix();i&&this._absoluteMatrix.multiplyToRef(i,this._absoluteMatrix)}let t=this.children,e=t.length;for(let i=0;i<e;i++)t[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}getDirection(t,e=null){let i=y.Zero();return this.getDirectionToRef(t,e,i),i}getDirectionToRef(t,e=null,i){let n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=r._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),e&&n&&s.multiplyToRef(n,s),y.TransformNormalToRef(t,s,i),i.normalize()}getRotation(t=0,e=null){let i=y.Zero();return this.getRotationToRef(t,e,i),i}getRotationToRef(t=0,e=null,i){let n=r._TmpQuat;this.getRotationQuaternionToRef(t,e,n),n.toEulerAnglesToRef(i)}getRotationQuaternion(t=0,e=null){let i=b.Identity();return this.getRotationQuaternionToRef(t,e,i),i}getRotationQuaternionToRef(t=0,e=null,i){if(t==0)this._decompose(),i.copyFrom(this._localRotation);else{let n=r._TmpMats[0],s=this.getAbsoluteMatrix();e?s.multiplyToRef(e.getWorldMatrix(),n):n.copyFrom(s),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,i,void 0)}}getRotationMatrix(t=0,e){let i=A.Identity();return this.getRotationMatrixToRef(t,e,i),i}getRotationMatrixToRef(t=0,e,i){if(t==0)this.getLocalMatrix().getRotationMatrixToRef(i);else{let n=r._TmpMats[0],s=this.getAbsoluteMatrix();e?s.multiplyToRef(e.getWorldMatrix(),n):n.copyFrom(s),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(i)}}getAbsolutePositionFromLocal(t,e=null){let i=y.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,i),i}getAbsolutePositionFromLocalToRef(t,e=null,i){let n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=r._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),e&&n&&s.multiplyToRef(n,s),y.TransformCoordinatesToRef(t,s,i)}getLocalPositionFromAbsolute(t,e=null){let i=y.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,i),i}getLocalPositionFromAbsoluteToRef(t,e=null,i){let n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=r._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),e&&n&&s.multiplyToRef(n,s),s.invert(),y.TransformCoordinatesToRef(t,s,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;let t=this._skeleton.bones.indexOf(this);if(t!==-1&&this._skeleton.bones.splice(t,1),this._parentNode&&this._parentNode.children){let e=this._parentNode.children,i=e.indexOf(this);i!==-1&&e.splice(i,1)}super.dispose()}};L._TmpVecs=q(2,y.Zero);L._TmpQuat=b.Identity();L._TmpMats=q(5,A.Identity)});var Q,gt=S(()=>{"use strict";w();K();Q=class{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(t,e,i,n){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=e,this._target=t,this._scene=i,this._host=n,this._activeTargets=[],e._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===g.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=A.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){let a={frame:0,value:this._minValue};this._keys.splice(0,0,a)}if(this._target instanceof Array){let a=0;for(let o of this._target)this._preparePath(o,a),this._getOriginalValues(a),a++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];let s=e.getEvents();s&&s.length>0&&s.forEach(a=>{this._events.push(a._clone())}),this._enableBlending=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(t,e=0){let i=this._animation.targetPropertyPath;if(i.length>1){let n=t;for(let s=0;s<i.length-1;s++){let a=i[s];if(n=n[a],n===void 0)throw new Error(`Invalid property (${a}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[e]=n}else this._targetPath=i[0],this._activeTargets[e]=t;if(this._activeTargets[e][this._targetPath]===void 0)throw new Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}get animation(){return this._animation}reset(t=!1){if(t)if(this._target instanceof Array){let e=0;for(let i of this._target)this._originalValue[e]!==void 0&&this._setValue(i,this._activeTargets[e],this._originalValue[e],-1,e),e++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let e=0;e<this._events.length;e++)this._events[e].isDone=!1}isStopped(){return this._stopped}dispose(){let t=this._animation.runtimeAnimations.indexOf(this);t>-1&&this._animation.runtimeAnimations.splice(t,1)}setValue(t,e){if(this._targetIsArray){for(let i=0;i<this._target.length;i++){let n=this._target[i];this._setValue(n,this._activeTargets[i],t,e,i)}return}this._setValue(this._target,this._directTarget,t,e,0)}_getOriginalValues(t=0){let e,i=this._activeTargets[t];i.getLocalMatrix&&this._targetPath==="_matrix"?e=i.getLocalMatrix():e=i[this._targetPath],e&&e.clone?this._originalValue[t]=e.clone():this._originalValue[t]=e}_registerTargetForLateAnimationBinding(t,e){let i=t.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[t.targetPath]||(i._lateAnimationHolders[t.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:e}),t.isAdditive?(i._lateAnimationHolders[t.targetPath].additiveAnimations.push(t),i._lateAnimationHolders[t.targetPath].totalAdditiveWeight+=t.weight):(i._lateAnimationHolders[t.targetPath].animations.push(t),i._lateAnimationHolders[t.targetPath].totalWeight+=t.weight)}_setValue(t,e,i,n,s){if(this._currentActiveTarget=e,this._weight=n,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){let o=e[this._targetPath];o.clone?this._originalBlendValue=o.clone():this._originalBlendValue=o}this._originalBlendValue.m?g.AllowMatrixDecomposeForInterpolation?this._currentValue?A.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=A.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?A.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=A.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=g._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);let a=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=a}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(i):this._currentValue=i:i?.clone?this._currentValue=i.clone():this._currentValue=i;n!==-1?this._registerTargetForLateAnimationBinding(this,this._originalValue[s]):this._animationState.loopMode===g.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[s],e[this._targetPath]):e[this._targetPath]=this._originalValue[s]+this._currentValue:e[this._targetPath]=this._currentValue,t.markAsDirty&&t.markAsDirty(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(t,e=-1){let i=this._animation.getKeys();t<i[0].frame?t=i[0].frame:t>i[i.length-1].frame&&(t=i[i.length-1].frame);let n=this._events;if(n.length)for(let a=0;a<n.length;a++)n[a].onlyOnce||(n[a].isDone=n[a].frame<t);this._currentFrame=t;let s=this._animation._interpolate(t,this._animationState);this.setValue(s,e)}_prepareForSpeedRatioChange(t){let e=this._previousElapsedTime*(this._animation.framePerSecond*t)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-e}animate(t,e,i,n,s,a=-1){let o=this._animation,l=o.targetPropertyPath;if(!l||l.length<1)return this._stopped=!0,!1;let h=!0;(e<this._minFrame||e>this._maxFrame)&&(e=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame);let c=i-e,m,d=t*(o.framePerSecond*s)/1e3+this._absoluteFrameOffset,u=0,p=!1,f=n&&this._animationState.loopMode===g.ANIMATIONLOOPMODE_YOYO;if(f){let _=(d-e)/c,M=Math.sin(_*Math.PI);d=Math.abs(M)*c+e;let Y=M>=0?1:-1;this._yoyoDirection!==Y&&(p=!0),this._yoyoDirection=Y}if(this._previousElapsedTime=t,this._previousAbsoluteFrame=d,!n&&i>=e&&(d>=c&&s>0||d<=0&&s<0))h=!1,u=o._getKeyValue(this._maxValue);else if(!n&&e>=i&&(d<=c&&s<0||d>=0&&s>0))h=!1,u=o._getKeyValue(this._minValue);else if(this._animationState.loopMode!==g.ANIMATIONLOOPMODE_CYCLE){let _=i.toString()+e.toString();if(!this._offsetsCache[_]){this._animationState.repeatCount=0,this._animationState.loopMode=g.ANIMATIONLOOPMODE_CYCLE;let M=o._interpolate(e,this._animationState),x=o._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),o.dataType){case g.ANIMATIONTYPE_FLOAT:this._offsetsCache[_]=x-M;break;case g.ANIMATIONTYPE_QUATERNION:this._offsetsCache[_]=x.subtract(M);break;case g.ANIMATIONTYPE_VECTOR3:this._offsetsCache[_]=x.subtract(M);break;case g.ANIMATIONTYPE_VECTOR2:this._offsetsCache[_]=x.subtract(M);break;case g.ANIMATIONTYPE_SIZE:this._offsetsCache[_]=x.subtract(M);break;case g.ANIMATIONTYPE_COLOR3:this._offsetsCache[_]=x.subtract(M);break;default:break}this._highLimitsCache[_]=x}u=this._highLimitsCache[_],m=this._offsetsCache[_]}if(m===void 0)switch(o.dataType){case g.ANIMATIONTYPE_FLOAT:m=0;break;case g.ANIMATIONTYPE_QUATERNION:m=$;break;case g.ANIMATIONTYPE_VECTOR3:m=G;break;case g.ANIMATIONTYPE_VECTOR2:m=tt;break;case g.ANIMATIONTYPE_SIZE:m=et;break;case g.ANIMATIONTYPE_COLOR3:m=it;break;case g.ANIMATIONTYPE_COLOR4:m=nt;break}let O;if(this._host&&this._host.syncRoot){let _=this._host.syncRoot,M=(_.masterFrame-_.fromFrame)/(_.toFrame-_.fromFrame);O=e+c*M}else d>0&&e>i||d<0&&e<i?O=h&&c!==0?i+d%c:e:O=h&&c!==0?e+d%c:i;let N=this._events;if(!f&&(s>0&&this.currentFrame>O||s<0&&this.currentFrame<O)||f&&p){this._onLoop();for(let _=0;_<N.length;_++)N[_].onlyOnce||(N[_].isDone=!1);this._animationState.key=s>0?0:o.getKeys().length-1}this._currentFrame=O,this._animationState.repeatCount=c===0?0:d/c>>0,this._animationState.highLimitValue=u,this._animationState.offsetValue=m;let T=o._interpolate(O,this._animationState);if(this.setValue(T,a),N.length){for(let _=0;_<N.length;_++)if(c>=0&&O>=N[_].frame&&N[_].frame>=e||c<0&&O<=N[_].frame&&N[_].frame<=e){let M=N[_];M.isDone||(M.onlyOnce&&(N.splice(_,1),_--),M.isDone=!0,M.action(O))}}return h||(this._stopped=!0),h}}});function Ft(r){if(r.totalWeight===0&&r.totalAdditiveWeight===0)return r.originalValue;let t=1,e=I.Vector3[0],i=I.Vector3[1],n=I.Quaternion[0],s=0,a=r.animations[0],o=r.originalValue,l=1,h=!1;if(r.totalWeight<1)l=1-r.totalWeight,o.decompose(i,n,e);else{if(s=1,t=r.totalWeight,l=a.weight/t,l==1)if(r.totalAdditiveWeight)h=!0;else return a.currentValue;a.currentValue.decompose(i,n,e)}if(!h){i.scaleInPlace(l),e.scaleInPlace(l),n.scaleInPlace(l);for(let m=s;m<r.animations.length;m++){let d=r.animations[m];if(d.weight===0)continue;l=d.weight/t;let u=I.Vector3[2],p=I.Vector3[3],f=I.Quaternion[1];d.currentValue.decompose(p,f,u),p.scaleAndAddToRef(l,i),f.scaleAndAddToRef(b.Dot(n,f)>0?l:-l,n),u.scaleAndAddToRef(l,e)}n.normalize()}for(let m=0;m<r.additiveAnimations.length;m++){let d=r.additiveAnimations[m];if(d.weight===0)continue;let u=I.Vector3[2],p=I.Vector3[3],f=I.Quaternion[1];d.currentValue.decompose(p,f,u),p.multiplyToRef(i,p),y.LerpToRef(i,p,d.weight,i),n.multiplyToRef(f,f),b.SlerpToRef(n,f,d.weight,n),u.scaleAndAddToRef(d.weight,e)}let c=a?a._animationState.workValue:I.Matrix[0].clone();return A.ComposeToRef(i,n,e,c),c}function Lt(r,t){if(r.totalWeight===0&&r.totalAdditiveWeight===0)return t;let e=r.animations[0],i=r.originalValue,n=t;if(r.totalWeight===0&&r.totalAdditiveWeight>0)n.copyFrom(i);else if(r.animations.length===1){if(b.SlerpToRef(i,e.currentValue,Math.min(1,r.totalWeight),n),r.totalAdditiveWeight===0)return n}else if(r.animations.length>1){let s=1,a,o;if(r.totalWeight<1){let h=1-r.totalWeight;a=[],o=[],a.push(i),o.push(h)}else{if(r.animations.length===2&&(b.SlerpToRef(r.animations[0].currentValue,r.animations[1].currentValue,r.animations[1].weight/r.totalWeight,t),r.totalAdditiveWeight===0))return t;a=[],o=[],s=r.totalWeight}for(let h=0;h<r.animations.length;h++){let c=r.animations[h];a.push(c.currentValue),o.push(c.weight/s)}let l=0;for(let h=0;h<a.length;){if(!h){b.SlerpToRef(a[h],a[h+1],o[h+1]/(o[h]+o[h+1]),t),n=t,l=o[h]+o[h+1],h+=2;continue}l+=o[h],b.SlerpToRef(n,a[h],o[h]/l,n),h++}}for(let s=0;s<r.additiveAnimations.length;s++){let a=r.additiveAnimations[s];a.weight!==0&&(n.multiplyToRef(a.currentValue,I.Quaternion[0]),b.SlerpToRef(n,I.Quaternion[0],a.weight,n))}return n}function Vt(r){if(r._registeredForLateAnimationBindings.length){for(let t=0;t<r._registeredForLateAnimationBindings.length;t++){let e=r._registeredForLateAnimationBindings.data[t];for(let i in e._lateAnimationHolders){let n=e._lateAnimationHolders[i],s=n.animations[0],a=n.originalValue;if(a==null)continue;let o=g.AllowMatrixDecomposeForInterpolation&&a.m,l=e[i];if(o)l=Ft(n);else if(a.w!==void 0)l=Lt(n,l||b.Identity());else{let c=0,m=1,d=s&&s._animationState.loopMode===g.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(n.totalWeight<1)d?l=a.clone?a.clone():a:s&&a.scale?l=a.scale(1-n.totalWeight):s?l=a*(1-n.totalWeight):a.clone?l=a.clone():l=a;else if(s){m=n.totalWeight;let u=s.weight/m;u!==1?s.currentValue.scale?l=s.currentValue.scale(u):l=s.currentValue*u:l=s.currentValue,d&&(l.addToRef?l.addToRef(a,l):l+=a),c=1}for(let u=c;u<n.animations.length;u++){let p=n.animations[u],f=p.weight/m;if(f)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(f,l):l+=p.currentValue*f;else continue}for(let u=0;u<n.additiveAnimations.length;u++){let p=n.additiveAnimations[u],f=p.weight;if(f)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(f,l):l+=p.currentValue*f;else continue}}e[i]=l}e._lateAnimationHolders={}}r._registeredForLateAnimationBindings.reset()}}function de(r,t,e){let i=t.target;r._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[t.targetPath]||(i._lateAnimationHolders[t.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:e}),t.isAdditive?(i._lateAnimationHolders[t.targetPath].additiveAnimations.push(t),i._lateAnimationHolders[t.targetPath].totalAdditiveWeight+=t.weight):(i._lateAnimationHolders[t.targetPath].animations.push(t),i._lateAnimationHolders[t.targetPath].totalWeight+=t.weight)}function pt(r,t){t&&(t.prototype.copyAnimationRange=function(e,i,n,s=!1,a=null){this.animations.length===0&&(this.animations.push(new g(this.name,"_matrix",e.animations[0].framePerSecond,g.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));let o=e.animations[0].getRange(i);if(!o)return!1;let l=o.from,h=o.to,c=e.animations[0].getKeys(),m=e.length,d=e.getParent(),u=this.getParent(),p=s&&d&&m&&this.length&&m!==this.length,f=p&&u&&d?u.length/d.length:1,O=s&&!u&&a&&(a.x!==1||a.y!==1||a.z!==1),N=this.animations[0].getKeys(),T,_,M;for(let x=0,Y=c.length;x<Y;x++)T=c[x],T.frame>=l&&T.frame<=h&&(s?(M=T.value.clone(),p?(_=M.getTranslation(),M.setTranslation(_.scaleInPlace(f))):O&&a?(_=M.getTranslation(),M.setTranslation(_.multiplyInPlace(a))):M=T.value):M=T.value,N.push({frame:T.frame+n,value:M}));return this.animations[0].createRange(i,l+n,h+n),!0}),r&&(r.prototype._animate=function(e){if(!this.animationsEnabled)return;let i=lt.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=i}this.deltaTime=e!==void 0?e:this.useConstantAnimationDeltaTime?16:(i-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=i;let n=this._activeAnimatables;if(n.length===0)return;this._animationTime+=this.deltaTime;let s=this._animationTime;for(let a=0;a<n.length;a++){let o=n[a];!o._animate(s)&&o.disposeOnEnd&&a--}Vt(this)},r.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort((e,i)=>e.playOrder-i.playOrder)},r.prototype.beginWeightedAnimation=function(e,i,n,s=1,a,o=1,l,h,c,m,d=!1){let u=this.beginAnimation(e,i,n,a,o,l,h,!1,c,m,d);return u.weight=s,u},r.prototype.beginAnimation=function(e,i,n,s,a=1,o,l,h=!0,c,m,d=!1){if(a<0){let p=i;i=n,n=p,a=-a}i>n&&(a=-a),h&&this.stopAnimation(e,void 0,c),l||(l=new H(this,e,i,n,s,a,o,void 0,m,d));let u=c?c(e):!0;if(e.animations&&u&&l.appendAnimations(e,e.animations),e.getAnimatables){let p=e.getAnimatables();for(let f=0;f<p.length;f++)this.beginAnimation(p[f],i,n,s,a,o,l,h,c,m)}return l.reset(),l},r.prototype.beginHierarchyAnimation=function(e,i,n,s,a,o=1,l,h,c=!0,m,d,u=!1){let p=e.getDescendants(i),f=[];f.push(this.beginAnimation(e,n,s,a,o,l,h,c,m,void 0,u));for(let O of p)f.push(this.beginAnimation(O,n,s,a,o,l,h,c,m,void 0,u));return f},r.prototype.beginDirectAnimation=function(e,i,n,s,a,o=1,l,h,c=!1){if(o<0){let d=n;n=s,s=d,o=-o}return n>s&&(o=-o),new H(this,e,n,s,a,o,l,i,h,c)},r.prototype.beginDirectHierarchyAnimation=function(e,i,n,s,a,o,l,h,c,m=!1){let d=e.getDescendants(i),u=[];u.push(this.beginDirectAnimation(e,n,s,a,o,l,h,c,m));for(let p of d)u.push(this.beginDirectAnimation(p,n,s,a,o,l,h,c,m));return u},r.prototype.getAnimatableByTarget=function(e){for(let i=0;i<this._activeAnimatables.length;i++)if(this._activeAnimatables[i].target===e)return this._activeAnimatables[i];return null},r.prototype.getAllAnimatablesByTarget=function(e){let i=[];for(let n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n].target===e&&i.push(this._activeAnimatables[n]);return i},r.prototype.stopAnimation=function(e,i,n){let s=this.getAllAnimatablesByTarget(e);for(let a of s)a.stop(i,n)},r.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(let e of this.animationGroups)e.stop()})}var H,st=S(()=>{"use strict";X();gt();K();yt();w();H=class{get syncRoot(){return this._syncRoot}get masterFrame(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(t){if(t===-1){this._weight=-1;return}this._weight=Math.min(Math.max(t,0),1)}get speedRatio(){return this._speedRatio}set speedRatio(t){for(let e=0;e<this._runtimeAnimations.length;e++)this._runtimeAnimations[e]._prepareForSpeedRatioChange(t);this._speedRatio=t,this._goToFrame!==null&&this.goToFrame(this._goToFrame)}get elapsedTime(){return this._localDelayOffset===null?0:this._scene._animationTime-this._localDelayOffset}constructor(t,e,i=0,n=100,s=!1,a=1,o,l,h,c=!1,m=0){this.target=e,this.fromFrame=i,this.toFrame=n,this.loopAnimation=s,this.onAnimationEnd=o,this.onAnimationLoop=h,this.isAdditive=c,this.playOrder=m,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new v,this.onAnimationLoopObservable=new v,this._scene=t,l&&this.appendAnimations(e,l),this._speedRatio=a,t._activeAnimatables.push(this)}syncWith(t){if(this._syncRoot=t,t){let e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(t,e){for(let i=0;i<e.length;i++){let n=e[i],s=new Q(t,n,this._scene,this);s._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(s)}}getAnimationByTargetProperty(t){let e=this._runtimeAnimations;for(let i=0;i<e.length;i++)if(e[i].animation.targetProperty===t)return e[i].animation;return null}getRuntimeAnimationByTargetProperty(t){let e=this._runtimeAnimations;for(let i=0;i<e.length;i++)if(e[i].animation.targetProperty===t)return e[i];return null}reset(){let t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(t){let e=this._runtimeAnimations;for(let i=0;i<e.length;i++)e[i].animation.enableBlending=!0,e[i].animation.blendingSpeed=t}disableBlending(){let t=this._runtimeAnimations;for(let e=0;e<t.length;e++)t[e].animation.enableBlending=!1}goToFrame(t,e=!1){let i=this._runtimeAnimations;if(i[0]){let n=i[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??i[0].currentFrame;let s=this.speedRatio===0?0:(t-this._frameToSyncFromJump)/n*1e3/this.speedRatio;this._manualJumpDelay=-s}for(let n=0;n<i.length;n++)i[n].goToFrame(t,e?this._weight:-1);this._goToFrame=t}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(t,e,i=!1,n=!1){if(t||e){let s=this._scene._activeAnimatables.indexOf(this);if(s>-1){let a=this._runtimeAnimations;for(let o=a.length-1;o>=0;o--){let l=a[o];t&&l.animation.name!=t||e&&!e(l.target)||(l.dispose(),a.splice(o,1))}a.length==0&&(i||this._scene._activeAnimatables.splice(s,1),n||this._raiseOnAnimationEnd())}}else{let s=this._scene._activeAnimatables.indexOf(this);if(s>-1){i||this._scene._activeAnimatables.splice(s,1);let a=this._runtimeAnimations;for(let o=0;o<a.length;o++)a[o].dispose();this._runtimeAnimations.length=0,n||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise(t=>{this.onAnimationEndObservable.add(()=>{t(this)},void 0,void 0,this,!0)})}_animate(t){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=t),!0;if(this._localDelayOffset===null?(this._localDelayOffset=t,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=t-this._pausedDelay,this._pausedDelay=null),this._manualJumpDelay!==null&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,this._weight===0)return!0;let e=!1,i=this._runtimeAnimations,n;for(n=0;n<i.length;n++){let a=i[n].animate(t-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);e=e||a}if(this.animationStarted=e,!e){if(this.disposeOnEnd)for(n=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(n,1),n=0;n<i.length;n++)i[n].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return e}}});var At=S(()=>{"use strict";_t();st();St();st();pt(dt,L)});var at,Tt,Dt=S(()=>{K();X();ot();Et();At();at=class{getClassName(){return"TargetedAnimation"}serialize(){let t={};return t.animation=this.animation.serialize(),t.targetId=this.target.id,t}},Tt=class r{get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this.syncWithMask(!0))}syncWithMask(t=!1){if(!this.mask&&!t){this._numActiveAnimatables=this._targetedAnimations.length;return}this._numActiveAnimatables=0;for(let e=0;e<this._animatables.length;++e){let i=this._animatables[e];!this.mask||this.mask.disabled||this.mask.retainsTarget(i.target.name)?(this._numActiveAnimatables++,i.paused&&i.restart()):i.paused||i.pause()}}removeUnmaskedAnimations(){if(!(!this.mask||this.mask.disabled)){for(let t=0;t<this._animatables.length;++t){let e=this._animatables[t];this.mask.retainsTarget(e.target.name)||(e.stop(),this._animatables.splice(t,1),--t)}for(let t=0;t<this._targetedAnimations.length;t++){let e=this._targetedAnimations[t];this.mask.retainsTarget(e.target.name)||(this._targetedAnimations.splice(t,1),--t)}}}get from(){return this._from}set from(t){if(this._from!==t){this._from=t;for(let e=0;e<this._animatables.length;e++){let i=this._animatables[e];i.fromFrame=this._from}}}get to(){return this._to}set to(t){if(this._to!==t){this._to=t;for(let e=0;e<this._animatables.length;e++){let i=this._animatables[e];i.toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(t){if(this._speedRatio!==t){this._speedRatio=t;for(let e=0;e<this._animatables.length;e++){let i=this._animatables[e];i.speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(t){if(this._loopAnimation!==t){this._loopAnimation=t;for(let e=0;e<this._animatables.length;e++){let i=this._animatables[e];i.loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(t){if(this._isAdditive!==t){this._isAdditive=t;for(let e=0;e<this._animatables.length;e++){let i=this._animatables[e];i.isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(t){this._weight!==t&&(this._weight=t,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(t){if(this._playOrder!==t&&(this._playOrder=t,this._animatables.length>0)){for(let e=0;e<this._animatables.length;e++)this._animatables[e].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(t){if(this._enableBlending!==t&&(this._enableBlending=t,t!==null))for(let e=0;e<this._targetedAnimations.length;++e)this._targetedAnimations[e].animation.enableBlending=t}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(t){if(this._blendingSpeed!==t&&(this._blendingSpeed=t,t!==null))for(let e=0;e<this._targetedAnimations.length;++e)this._targetedAnimations[e].animation.blendingSpeed=t}getLength(t,e){t=t??this._from,e=e??this._to;let i=this.targetedAnimations[0].animation.framePerSecond*this._speedRatio;return(e-t)/i}static MergeAnimationGroups(t,e=!0,i=!1,n){if(t.length===0)return null;n=n??t[0].weight;let s=Number.MAX_VALUE,a=-Number.MAX_VALUE;if(i)for(let l of t)l.from<s&&(s=l.from),l.to>a&&(a=l.to);let o=new r(t[0].name+"_merged",t[0]._scene,n);for(let l of t){i&&l.normalize(s,a);for(let h of l.targetedAnimations)o.addTargetedAnimation(h.animation,h.target);e&&l.dispose()}return o}constructor(t,e=null,i=-1,n=0){this.name=t,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new v,this.onAnimationLoopObservable=new v,this.onAnimationGroupLoopObservable=new v,this.onAnimationGroupEndObservable=new v,this.onAnimationGroupPauseObservable=new v,this.onAnimationGroupPlayObservable=new v,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=e||W.LastCreatedScene,this._weight=i,this._playOrder=n,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(t,e){let i=new at;i.animation=t,i.target=e;let n=t.getKeys();return this._from>n[0].frame&&(this._from=n[0].frame),this._to<n[n.length-1].frame&&(this._to=n[n.length-1].frame),this._enableBlending!==null&&(t.enableBlending=this._enableBlending),this._blendingSpeed!==null&&(t.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(i),this._shouldStart=!0,i}removeTargetedAnimation(t){for(let e=this._targetedAnimations.length-1;e>-1;e--)this._targetedAnimations[e].animation===t&&this._targetedAnimations.splice(e,1)}normalize(t=null,e=null){t==null&&(t=this._from),e==null&&(e=this._to);for(let i=0;i<this._targetedAnimations.length;i++){let s=this._targetedAnimations[i].animation.getKeys(),a=s[0],o=s[s.length-1];if(a.frame>t){let l={frame:t,value:a.value,inTangent:a.inTangent,outTangent:a.outTangent,interpolation:a.interpolation};s.splice(0,0,l)}if(o.frame<e){let l={frame:e,value:o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation};s.push(l)}}return this._from=t,this._to=e,this}_processLoop(t,e,i){t.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(e),!this._animationLoopFlags[i]&&(this._animationLoopFlags[i]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(t=!1,e=1,i,n,s){if(this._isStarted||this._targetedAnimations.length===0)return this;this._loopAnimation=t,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let a=0;a<this._targetedAnimations.length;a++){let o=this._targetedAnimations[a],l=this._scene.beginDirectAnimation(o.target,[o.animation],i!==void 0?i:this._from,n!==void 0?n:this._to,t,e,void 0,void 0,s!==void 0?s:this._isAdditive);l.weight=this._weight,l.playOrder=this._playOrder,l.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(o),this._checkAnimationGroupEnded(l)},this._processLoop(l,o,a),this._animatables.push(l)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=e,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let t=0;t<this._animatables.length;t++)this._animatables[t].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(t){return this.isStarted&&this._animatables.length&&!this._shouldStart?(t!==void 0&&(this.loopAnimation=t),this.restart()):(this.stop(),this.start(t,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let t=0;t<this._animatables.length;t++)this._animatables[t].reset();return this}restart(){if(!this._isStarted)return this;for(let t=0;t<this._animatables.length;t++)this._animatables[t].restart();return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(t=!1){if(!this._isStarted)return this;let e=this._animatables.slice();for(let n=0;n<e.length;n++)e[n].stop(void 0,void 0,!0,t);let i=0;for(let n=0;n<this._scene._activeAnimatables.length;n++){let s=this._scene._activeAnimatables[n];s._runtimeAnimations.length>0?this._scene._activeAnimatables[i++]=s:t&&this._checkAnimationGroupEnded(s,t)}return this._scene._activeAnimatables.length=i,this._isStarted=!1,this}setWeightForAllAnimatables(t){for(let e=0;e<this._animatables.length;e++){let i=this._animatables[e];i.weight=t}return this}syncAllAnimationsWith(t){for(let e=0;e<this._animatables.length;e++)this._animatables[e].syncWith(t);return this}goToFrame(t,e=!1){if(!this._isStarted)return this;for(let i=0;i<this._animatables.length;i++)this._animatables[i].goToFrame(t,e);return this}getCurrentFrame(){return this.animatables[0]?.masterFrame||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;let t=this._scene.animationGroups.indexOf(this);if(t>-1&&this._scene.animationGroups.splice(t,1),this._parentContainer){let e=this._parentContainer.animationGroups.indexOf(this);e>-1&&this._parentContainer.animationGroups.splice(e,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(t,e=!1){let i=this._animatables.indexOf(t);i>-1&&this._animatables.splice(i,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,e||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(t,e,i=!1){let n=new r(t||this.name,this._scene,this._weight,this._playOrder);n._from=this.from,n._to=this.to,n._speedRatio=this.speedRatio,n._loopAnimation=this.loopAnimation,n._isAdditive=this.isAdditive,n._enableBlending=this.enableBlending,n._blendingSpeed=this.blendingSpeed,n.metadata=this.metadata,n.mask=this.mask;for(let s of this._targetedAnimations)n.addTargetedAnimation(i?s.animation.clone():s.animation,e?e(s.target):s.target);return n}serialize(){let t={};t.name=this.name,t.from=this.from,t.to=this.to,t.speedRatio=this.speedRatio,t.loopAnimation=this.loopAnimation,t.isAdditive=this.isAdditive,t.weight=this.weight,t.playOrder=this.playOrder,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,t.targetedAnimations=[];for(let e=0;e<this.targetedAnimations.length;e++){let i=this.targetedAnimations[e];t.targetedAnimations[e]=i.serialize()}return k&&k.HasTags(this)&&(t.tags=k.GetTags(this)),this.metadata&&(t.metadata=this.metadata),t}static Parse(t,e){let i=new r(t.name,e,t.weight,t.playOrder);for(let n=0;n<t.targetedAnimations.length;n++){let s=t.targetedAnimations[n],a=g.Parse(s.animation),o=s.targetId;if(s.animation.property==="influence"){let l=e.getMorphTargetById(o);l&&i.addTargetedAnimation(a,l)}else{let l=e.getNodeById(o);l!=null&&i.addTargetedAnimation(a,l)}}return k&&k.AddTagsTo(i,t.tags),t.from!==null&&t.to!==null&&i.normalize(t.from,t.to),t.speedRatio!==void 0&&(i._speedRatio=t.speedRatio),t.loopAnimation!==void 0&&(i._loopAnimation=t.loopAnimation),t.isAdditive!==void 0&&(i._isAdditive=t.isAdditive),t.weight!==void 0&&(i._weight=t.weight),t.playOrder!==void 0&&(i._playOrder=t.playOrder),t.enableBlending!==void 0&&(i._enableBlending=t.enableBlending),t.blendingSpeed!==void 0&&(i._blendingSpeed=t.blendingSpeed),t.metadata!==void 0&&(i.metadata=t.metadata),i}static MakeAnimationAdditive(t,e,i,n=!1,s){let a;typeof e=="object"?a=e:a={referenceFrame:e,range:i,cloneOriginalAnimationGroup:n,clonedAnimationName:s};let o=t;a.cloneOriginalAnimationGroup&&(o=t.clone(a.clonedAnimationGroupName||o.name));let l=o.targetedAnimations;for(let h=0;h<l.length;h++){let c=l[h];c.animation=g.MakeAnimationAdditive(c.animation,a)}if(o.isAdditive=!0,a.clipKeys){let h=Number.MAX_VALUE,c=-Number.MAX_VALUE,m=o.targetedAnimations;for(let d=0;d<m.length;d++){let f=m[d].animation.getKeys();h>f[0].frame&&(h=f[0].frame),c<f[f.length-1].frame&&(c=f[f.length-1].frame)}o._from=h,o._to=c}return o}static ClipKeys(t,e,i,n,s){let a=t.clone(n||t.name);return r.ClipKeysInPlace(a,e,i,s)}static ClipKeysInPlace(t,e,i,n){return r.ClipInPlace(t,e,i,n,!1)}static ClipFrames(t,e,i,n,s){let a=t.clone(n||t.name);return r.ClipFramesInPlace(a,e,i,s)}static ClipFramesInPlace(t,e,i,n){return r.ClipInPlace(t,e,i,n,!0)}static ClipInPlace(t,e,i,n,s=!1){let a=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=t.targetedAnimations;for(let h=0;h<l.length;h++){let c=l[h],m=n?c.animation:c.animation.clone();s&&(m.createKeyForFrame(e),m.createKeyForFrame(i));let d=m.getKeys(),u=[],p=Number.MAX_VALUE;for(let f=0;f<d.length;f++){let O=d[f];if(!s&&f>=e&&f<=i||s&&O.frame>=e&&O.frame<=i){let N={frame:O.frame,value:O.value.clone?O.value.clone():O.value,inTangent:O.inTangent,outTangent:O.outTangent,interpolation:O.interpolation,lockedTangent:O.lockedTangent};p===Number.MAX_VALUE&&(p=N.frame),N.frame-=p,u.push(N)}}if(u.length===0){l.splice(h,1),h--;continue}a>u[0].frame&&(a=u[0].frame),o<u[u.length-1].frame&&(o=u[u.length-1].frame),m.setKeys(u,!0),c.animation=m}return t._from=a,t._to=o,t}getClassName(){return"AnimationGroup"}toString(t){let e="Name: "+this.name;return e+=", type: "+this.getClassName(),t&&(e+=", from: "+this._from,e+=", to: "+this._to,e+=", isStarted: "+this._isStarted,e+=", speedRatio: "+this._speedRatio,e+=", targetedAnimations length: "+this._targetedAnimations.length,e+=", animatables length: "+this._animatables),e}}});export{R as a,J as b,B as c,ft as d,$ as e,G as f,tt as g,et as h,it as i,nt as j,g as k,K as l,L as m,_t as n,Q as o,gt as p,H as q,de as r,pt as s,At as t,at as u,Tt as v,Dt as w};
