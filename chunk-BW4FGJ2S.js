import{a as re,b as le}from"./chunk-GSEL6DW7.js";import{b as oe}from"./chunk-6OWLVBYT.js";import{b as ae}from"./chunk-LM7YVWIF.js";import{b as ne}from"./chunk-CVT54UUX.js";import{b as ie}from"./chunk-U43K2EKK.js";import{b as se}from"./chunk-IRFJOALB.js";import{b as te}from"./chunk-NKAZBHMF.js";import{a as R,b as ee}from"./chunk-IKEYJ3OZ.js";import{a as F,d as Z,e as C,f as j,w as I,x as J}from"./chunk-IYNELJD3.js";import{j as p,o as g}from"./chunk-W427QTGG.js";import{g as h,h as S,i as $}from"./chunk-M4D4SI2K.js";import{a as M,b as Q}from"./chunk-BE7GIU5G.js";import{e as L,f as q}from"./chunk-GDJFI7EY.js";import{a as m,b as U}from"./chunk-PJTN5MCN.js";import{d as c}from"./chunk-SO6VPFYA.js";function Me(t){t.indexOf("vClipPlane")===-1&&t.push("vClipPlane"),t.indexOf("vClipPlane2")===-1&&t.push("vClipPlane2"),t.indexOf("vClipPlane3")===-1&&t.push("vClipPlane3"),t.indexOf("vClipPlane4")===-1&&t.push("vClipPlane4"),t.indexOf("vClipPlane5")===-1&&t.push("vClipPlane5"),t.indexOf("vClipPlane6")===-1&&t.push("vClipPlane6")}function Ce(t,e,r){let o=!!(t.clipPlane??e.clipPlane),a=!!(t.clipPlane2??e.clipPlane2),i=!!(t.clipPlane3??e.clipPlane3),n=!!(t.clipPlane4??e.clipPlane4),s=!!(t.clipPlane5??e.clipPlane5),u=!!(t.clipPlane6??e.clipPlane6);o&&r.push("#define CLIPPLANE"),a&&r.push("#define CLIPPLANE2"),i&&r.push("#define CLIPPLANE3"),n&&r.push("#define CLIPPLANE4"),s&&r.push("#define CLIPPLANE5"),u&&r.push("#define CLIPPLANE6")}function H(t,e,r){let o=!1,a=!!(t.clipPlane??e.clipPlane),i=!!(t.clipPlane2??e.clipPlane2),n=!!(t.clipPlane3??e.clipPlane3),s=!!(t.clipPlane4??e.clipPlane4),u=!!(t.clipPlane5??e.clipPlane5),l=!!(t.clipPlane6??e.clipPlane6);return r.CLIPPLANE!==a&&(r.CLIPPLANE=a,o=!0),r.CLIPPLANE2!==i&&(r.CLIPPLANE2=i,o=!0),r.CLIPPLANE3!==n&&(r.CLIPPLANE3=n,o=!0),r.CLIPPLANE4!==s&&(r.CLIPPLANE4=s,o=!0),r.CLIPPLANE5!==u&&(r.CLIPPLANE5=u,o=!0),r.CLIPPLANE6!==l&&(r.CLIPPLANE6=l,o=!0),o}function Ie(t,e,r){let o=e.clipPlane??r.clipPlane;N(t,"vClipPlane",o),o=e.clipPlane2??r.clipPlane2,N(t,"vClipPlane2",o),o=e.clipPlane3??r.clipPlane3,N(t,"vClipPlane3",o),o=e.clipPlane4??r.clipPlane4,N(t,"vClipPlane4",o),o=e.clipPlane5??r.clipPlane5,N(t,"vClipPlane5",o),o=e.clipPlane6??r.clipPlane6,N(t,"vClipPlane6",o)}function N(t,e,r){r&&t.setFloat4(e,r.normal.x,r.normal.y,r.normal.z,r.d)}var V=c(()=>{"use strict"});function He(t,e,r){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){let o=r.activeCamera;o.mode===1&&M.Error("Logarithmic depth is not compatible with orthographic cameras!",20),e.setFloat("logarithmicDepthConstant",2/(Math.log(o.maxZ+1)/Math.LN2))}}function Ve(t,e,r,o=!1){r&&t.fogEnabled&&(!e||e.applyFog)&&t.fogMode!==0&&(r.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),o?(t.fogColor.toLinearSpaceToRef(G,t.getEngine().useExactSrgbConversions),r.setColor3("vFogColor",G)):r.setColor3("vFogColor",t.fogColor))}function B(t,e,r,o,a,i,n,s,u){let l=t.numMaxInfluencers||t.numInfluencers;return l<=0?0:(e.push("#define MORPHTARGETS"),t.hasPositions&&e.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),t.hasNormals&&e.push("#define MORPHTARGETTEXTURE_HASNORMALS"),t.hasTangents&&e.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),t.hasUVs&&e.push("#define MORPHTARGETTEXTURE_HASUVS"),t.hasUV2s&&e.push("#define MORPHTARGETTEXTURE_HASUV2S"),t.supportsPositions&&a&&e.push("#define MORPHTARGETS_POSITION"),t.supportsNormals&&i&&e.push("#define MORPHTARGETS_NORMAL"),t.supportsTangents&&n&&e.push("#define MORPHTARGETS_TANGENT"),t.supportsUVs&&s&&e.push("#define MORPHTARGETS_UV"),t.supportsUV2s&&u&&e.push("#define MORPHTARGETS_UV2"),e.push("#define NUM_MORPH_INFLUENCERS "+l),t.isUsingTextureForTargets&&e.push("#define MORPHTARGETS_TEXTURE"),T.NUM_MORPH_INFLUENCERS=l,T.NORMAL=i,T.TANGENT=n,T.UV=s,T.UV2=u,v(r,o,T,a),l)}function Ge(t,e,r){T.NUM_MORPH_INFLUENCERS=r,T.NORMAL=!1,T.TANGENT=!1,T.UV=!1,T.UV2=!1,v(t,e,T,!0)}function v(t,e,r,o=!0){let a=r.NUM_MORPH_INFLUENCERS;if(a>0&&L.LastCreatedEngine){let i=L.LastCreatedEngine.getCaps().maxVertexAttribs,n=e.morphTargetManager;if(n?.isUsingTextureForTargets)return;let s=n&&n.supportsPositions&&o,u=n&&n.supportsNormals&&r.NORMAL,l=n&&n.supportsTangents&&r.TANGENT,A=n&&n.supportsUVs&&r.UV1,E=n&&n.supportsUV2s&&r.UV2;for(let P=0;P<a;P++)s&&t.push("position"+P),u&&t.push("normal"+P),l&&t.push("tangent"+P),A&&t.push("uv_"+P),E&&t.push("uv2_"+P),t.length>i&&M.Error("Cannot add more vertex attributes for mesh "+e.name)}}function ue(t,e=!1){t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),e&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}function b(t,e){let r=t.morphTargetManager;!t||!r||e.setFloatArray("morphTargetInfluences",r.influences)}function Be(t,e){e.bindToEffect(t,"Scene")}function ve(t,e,r){e._needUVs=!0,e[r]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(e[r+"DIRECTUV"]=t.coordinatesIndex+1,e["MAINUV"+(t.coordinatesIndex+1)]=!0):e[r+"DIRECTUV"]=0}function be(t,e,r){let o=t.getTextureMatrix();e.updateMatrix(r+"Matrix",o)}function W(t,e,r){r.BAKED_VERTEX_ANIMATION_TEXTURE&&r.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}function Ee(t,e){return e.set(t),e}function X(t,e,r){if(!(!e||!t)&&(t.computeBonesUsingShaders&&e._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){let o=t.skeleton;if(o.isUsingTextureForMatrices&&e.getUniformIndex("boneTextureWidth")>-1){let a=o.getTransformMatrixTexture(t);e.setTexture("boneSampler",a),e.setFloat("boneTextureWidth",4*(o.bones.length+1))}else{let a=o.getTransformMatrices(t);a&&(e.setMatrices("mBones",a),r&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(r.previousBones[t.uniqueId]||(r.previousBones[t.uniqueId]=a.slice()),e.setMatrices("mPreviousBones",r.previousBones[t.uniqueId]),Ee(a,r.previousBones[t.uniqueId])))}}}function We(t,e,r){t.transferToEffect(e,r+"")}function pe(t,e,r,o,a,i=!0){t._bindLight(e,r,o,a,i)}function Xe(t,e,r,o,a=4){let i=Math.min(e.lightSources.length,a);for(let n=0;n<i;n++){let s=e.lightSources[n];pe(s,n,t,r,typeof o=="boolean"?o:o.SPECULARTERM,e.receiveShadows)}}function de(t,e,r,o){r.NUM_BONE_INFLUENCERS>0&&(o.addCPUSkinningFallback(0,e),t.push("matricesIndices"),t.push("matricesWeights"),r.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}function ye(t,e){(e.INSTANCES||e.THIN_INSTANCES)&&ue(t,!!e.PREPASS_VELOCITY),e.INSTANCESCOLOR&&t.push("instanceColor")}function ke(t,e,r=4,o=0){let a=0;for(let i=0;i<r&&t["LIGHT"+i];i++)i>0&&(a=o+i,e.addFallback(a,"LIGHT"+i)),t.SHADOWS||(t["SHADOW"+i]&&e.addFallback(o,"SHADOW"+i),t["SHADOWPCF"+i]&&e.addFallback(o,"SHADOWPCF"+i),t["SHADOWPCSS"+i]&&e.addFallback(o,"SHADOWPCSS"+i),t["SHADOWPOISSON"+i]&&e.addFallback(o,"SHADOWPOISSON"+i),t["SHADOWESM"+i]&&e.addFallback(o,"SHADOWESM"+i),t["SHADOWCLOSEESM"+i]&&e.addFallback(o,"SHADOWCLOSEESM"+i));return a++}function Ae(t,e){return e.fogEnabled&&t.applyFog&&e.fogMode!==0}function we(t,e,r,o,a,i,n,s=!1){n._areMiscDirty&&(n.LOGARITHMICDEPTH=r,n.POINTSIZE=o,n.FOG=a&&Ae(t,e),n.NONUNIFORMSCALING=t.nonUniformScaling,n.ALPHATEST=i,n.DECAL_AFTER_DETAIL=s)}function ze(t,e,r,o,a=4,i=!1){if(!r._areLightsDirty)return r._needNormals;let n=0,s={needNormals:r._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(t.lightsEnabled&&!i){for(let l of e.lightSources)if(Te(t,e,l,n,r,o,s),n++,n===a)break}r.SPECULARTERM=s.specularEnabled,r.SHADOWS=s.shadowEnabled;for(let l=n;l<a;l++)r["LIGHT"+l]!==void 0&&(r["LIGHT"+l]=!1,r["HEMILIGHT"+l]=!1,r["POINTLIGHT"+l]=!1,r["DIRLIGHT"+l]=!1,r["SPOTLIGHT"+l]=!1,r["SHADOW"+l]=!1,r["SHADOWCSM"+l]=!1,r["SHADOWCSMDEBUG"+l]=!1,r["SHADOWCSMNUM_CASCADES"+l]=!1,r["SHADOWCSMUSESHADOWMAXZ"+l]=!1,r["SHADOWCSMNOBLEND"+l]=!1,r["SHADOWCSM_RIGHTHANDED"+l]=!1,r["SHADOWPCF"+l]=!1,r["SHADOWPCSS"+l]=!1,r["SHADOWPOISSON"+l]=!1,r["SHADOWESM"+l]=!1,r["SHADOWCLOSEESM"+l]=!1,r["SHADOWCUBE"+l]=!1,r["SHADOWLOWQUALITY"+l]=!1,r["SHADOWMEDIUMQUALITY"+l]=!1);let u=t.getEngine().getCaps();return r.SHADOWFLOAT===void 0&&(s.needRebuild=!0),r.SHADOWFLOAT=s.shadowEnabled&&(u.textureFloatRender&&u.textureFloatLinearFiltering||u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&r.rebuild(),s.needNormals}function Te(t,e,r,o,a,i,n){switch(n.needNormals=!0,a["LIGHT"+o]===void 0&&(n.needRebuild=!0),a["LIGHT"+o]=!0,a["SPOTLIGHT"+o]=!1,a["HEMILIGHT"+o]=!1,a["POINTLIGHT"+o]=!1,a["DIRLIGHT"+o]=!1,r.prepareLightSpecificDefines(a,o),a["LIGHT_FALLOFF_PHYSICAL"+o]=!1,a["LIGHT_FALLOFF_GLTF"+o]=!1,a["LIGHT_FALLOFF_STANDARD"+o]=!1,r.falloffType){case R.FALLOFF_GLTF:a["LIGHT_FALLOFF_GLTF"+o]=!0;break;case R.FALLOFF_PHYSICAL:a["LIGHT_FALLOFF_PHYSICAL"+o]=!0;break;case R.FALLOFF_STANDARD:a["LIGHT_FALLOFF_STANDARD"+o]=!0;break}if(i&&!r.specular.equalsFloats(0,0,0)&&(n.specularEnabled=!0),a["SHADOW"+o]=!1,a["SHADOWCSM"+o]=!1,a["SHADOWCSMDEBUG"+o]=!1,a["SHADOWCSMNUM_CASCADES"+o]=!1,a["SHADOWCSMUSESHADOWMAXZ"+o]=!1,a["SHADOWCSMNOBLEND"+o]=!1,a["SHADOWCSM_RIGHTHANDED"+o]=!1,a["SHADOWPCF"+o]=!1,a["SHADOWPCSS"+o]=!1,a["SHADOWPOISSON"+o]=!1,a["SHADOWESM"+o]=!1,a["SHADOWCLOSEESM"+o]=!1,a["SHADOWCUBE"+o]=!1,a["SHADOWLOWQUALITY"+o]=!1,a["SHADOWMEDIUMQUALITY"+o]=!1,e&&e.receiveShadows&&t.shadowsEnabled&&r.shadowEnabled){let s=r.getShadowGenerator(t.activeCamera)??r.getShadowGenerator();if(s){let u=s.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(n.shadowEnabled=!0,s.prepareDefines(a,o))}}r.lightmapMode!=R.LIGHTMAP_DEFAULT?(n.lightmapMode=!0,a["LIGHTMAPEXCLUDED"+o]=!0,a["LIGHTMAPNOSPECULAR"+o]=r.lightmapMode==R.LIGHTMAP_SHADOWSONLY):(a["LIGHTMAPEXCLUDED"+o]=!1,a["LIGHTMAPNOSPECULAR"+o]=!1)}function Ye(t,e,r,o,a,i=null,n=!1){let s=Re(t,o);i!==!1&&(s=H(r,t,o)),o.DEPTHPREPASS!==!e.getColorWrite()&&(o.DEPTHPREPASS=!o.DEPTHPREPASS,s=!0),o.INSTANCES!==a&&(o.INSTANCES=a,s=!0),o.THIN_INSTANCES!==n&&(o.THIN_INSTANCES=n,s=!0),s&&o.markAsUnprocessed()}function Pe(t,e){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){e.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;let r=e.BONETEXTURE!==void 0;if(t.skeleton.isUsingTextureForMatrices&&r)e.BONETEXTURE=!0;else{e.BonesPerMesh=t.skeleton.bones.length+1,e.BONETEXTURE=r?!1:void 0;let o=t.getScene().prePassRenderer;if(o&&o.enabled){let a=o.excludedSkinnedMesh.indexOf(t)===-1;e.BONES_VELOCITY_ENABLED=a}}}else e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE!==void 0&&(e.BONETEXTURE=!1)}function Se(t,e){let r=t.morphTargetManager;r?(e.MORPHTARGETS_UV=r.supportsUVs&&e.UV1,e.MORPHTARGETS_UV2=r.supportsUV2s&&e.UV2,e.MORPHTARGETS_TANGENT=r.supportsTangents&&e.TANGENT,e.MORPHTARGETS_NORMAL=r.supportsNormals&&e.NORMAL,e.MORPHTARGETS_POSITION=r.supportsPositions,e.MORPHTARGETTEXTURE_HASUVS=r.hasUVs,e.MORPHTARGETTEXTURE_HASUV2S=r.hasUV2s,e.MORPHTARGETTEXTURE_HASTANGENTS=r.hasTangents,e.MORPHTARGETTEXTURE_HASNORMALS=r.hasNormals,e.MORPHTARGETTEXTURE_HASPOSITIONS=r.hasPositions,e.NUM_MORPH_INFLUENCERS=r.numMaxInfluencers||r.numInfluencers,e.MORPHTARGETS=e.NUM_MORPH_INFLUENCERS>0,e.MORPHTARGETS_TEXTURE=r.isUsingTextureForTargets):(e.MORPHTARGETS_UV=!1,e.MORPHTARGETS_UV2=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_POSITION=!1,e.MORPHTARGETTEXTURE_HASUVS=!1,e.MORPHTARGETTEXTURE_HASUV2S=!1,e.MORPHTARGETTEXTURE_HASTANGENTS=!1,e.MORPHTARGETTEXTURE_HASNORMALS=!1,e.MORPHTARGETTEXTURE_HASPOSITIONS=!1,e.MORPHTARGETS=!1,e.NUM_MORPH_INFLUENCERS=0)}function ce(t,e){let r=t.bakedVertexAnimationManager;e.BAKED_VERTEX_ANIMATION_TEXTURE=!!(r&&r.isEnabled)}function Ke(t,e,r,o,a=!1,i=!0,n=!0){if(!e._areAttributesDirty&&e._needNormals===e._normals&&e._needUVs===e._uvs)return!1;e._normals=e._needNormals,e._uvs=e._needUVs,e.NORMAL=e._needNormals&&t.isVerticesDataPresent("normal"),e._needNormals&&t.isVerticesDataPresent("tangent")&&(e.TANGENT=!0);for(let s=1;s<=6;++s)e["UV"+s]=e._needUVs?t.isVerticesDataPresent(`uv${s===1?"":s}`):!1;if(r){let s=t.useVertexColors&&t.isVerticesDataPresent("color");e.VERTEXCOLOR=s,e.VERTEXALPHA=t.hasVertexAlpha&&s&&i}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(e.INSTANCESCOLOR=!0),o&&Pe(t,e),a&&Se(t,e),n&&ce(t,e),!0}function qe(t,e){if(t.activeCamera){let r=e.MULTIVIEW;e.MULTIVIEW=t.activeCamera.outputRenderTarget!==null&&t.activeCamera.outputRenderTarget.getViewCount()>1,e.MULTIVIEW!=r&&e.markAsUnprocessed()}}function Qe(t,e,r){let o=e.ORDER_INDEPENDENT_TRANSPARENCY,a=e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;e.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&r,e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,(o!==e.ORDER_INDEPENDENT_TRANSPARENCY||a!==e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&e.markAsUnprocessed()}function Ze(t,e,r){let o=e.PREPASS;if(!e._arePrePassDirty)return;let a=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&r){e.PREPASS=!0,e.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,e.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,e.PREPASS_COLOR=!0,e.PREPASS_COLOR_INDEX=0;for(let i=0;i<a.length;i++){let n=t.prePassRenderer.getIndex(a[i].type);n!==-1?(e[a[i].define]=!0,e[a[i].index]=n):e[a[i].define]=!1}}else{e.PREPASS=!1;for(let i=0;i<a.length;i++)e[a[i].define]=!1}e.PREPASS!=o&&(e.markAsUnprocessed(),e.markAsImageProcessingDirty())}function Re(t,e){let r=!1;if(t.activeCamera){let o=e.CAMERA_ORTHOGRAPHIC?1:0,a=e.CAMERA_PERSPECTIVE?1:0,i=t.activeCamera.mode===1?1:0,n=t.activeCamera.mode===0?1:0;(o^i||a^n)&&(e.CAMERA_ORTHOGRAPHIC=i===1,e.CAMERA_PERSPECTIVE=n===1,r=!0)}return r}function Ne(t,e,r,o,a=null,i=!1,n=!1){a&&a.push("Light"+t),!i&&(e.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightFalloff"+t,"vLightGround"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),r.push("shadowTexture"+t),r.push("depthTexture"+t),e.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),o&&(r.push("projectionLightTexture"+t),e.push("textureProjectionMatrix"+t)),n&&r.push("iesLightTexture"+t))}function je(t,e,r,o=4){let a,i=null;if(t.uniformsNames){let n=t;a=n.uniformsNames,i=n.uniformBuffersNames,e=n.samplers,r=n.defines,o=n.maxSimultaneousLights||0}else a=t,e||(e=[]);for(let n=0;n<o&&r["LIGHT"+n];n++)Ne(n,a,e,r["PROJECTEDLIGHTTEXTURE"+n],i,!1,r["IESLIGHTTEXTURE"+n]);r.NUM_MORPH_INFLUENCERS&&(a.push("morphTargetInfluences"),a.push("morphTargetCount")),r.BAKED_VERTEX_ANIMATION_TEXTURE&&(a.push("bakedVertexAnimationSettings"),a.push("bakedVertexAnimationTextureSizeInverted"),a.push("bakedVertexAnimationTime"),e.push("bakedVertexAnimationTexture"))}var G,T,d=c(()=>{"use strict";Q();Z();q();ee();V();G=F.Black(),T={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1}});function rt(t,e,r,o,a=null){let i=new p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return _.extractMinAndMaxIndexed(t,e,r,o,i,n),a&&(i.x-=i.x*a.x+a.y,i.y-=i.y*a.x+a.y,i.z-=i.z*a.x+a.y,n.x+=n.x*a.x+a.y,n.y+=n.y*a.x+a.y,n.z+=n.z*a.x+a.y),{minimum:i,maximum:n}}function x(t,e,r,o=null,a){let i=new p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a||(a=3),_.extractMinAndMax(t,e,r,a,i,n),o&&(i.x-=i.x*o.x+o.y,i.y-=i.y*o.x+o.y,i.z-=i.z*o.x+o.y,n.x+=n.x*o.x+o.y,n.y+=n.y*o.x+o.y,n.z+=n.z*o.x+o.y),{minimum:i,maximum:n}}function ot(t,e){let r=x(t,0,t.length/3),o=r.maximum.subtract(r.minimum).scale(.5).add(r.minimum),a=new p,i=new p,n=new p,s=new p,u=new p,l=new p,A=new p;for(let E=0;E<e.length;E+=3){let P=e[E],D=e[E+1],f=e[E+2];a.fromArray(t,P*3),i.fromArray(t,D*3),n.fromArray(t,f*3),i.subtractToRef(a,s),n.subtractToRef(a,u),p.CrossToRef(s,u,l),l.normalize();let z=a.x+i.x+n.x,Y=a.y+i.y+n.y,K=a.z+i.z+n.z;A.set(z/3,Y/3,K/3),A.subtractInPlace(o),A.normalize(),p.Dot(l,A)>=0&&(e[E]=f,e[E+2]=P)}}var _,y=c(()=>{"use strict";j();g();J();_=class{static extractMinAndMaxIndexed(e,r,o,a,i,n){for(let s=o;s<o+a;s++){let u=r[s]*3,l=e[u],A=e[u+1],E=e[u+2];i.minimizeInPlaceFromFloats(l,A,E),n.maximizeInPlaceFromFloats(l,A,E)}}static extractMinAndMax(e,r,o,a,i,n){for(let s=r,u=r*a;s<r+o;s++,u+=a){let l=e[u],A=e[u+1],E=e[u+2];i.minimizeInPlaceFromFloats(l,A,E),n.maximizeInPlaceFromFloats(l,A,E)}}};C([I.filter((...[t,e])=>!Array.isArray(t)&&!Array.isArray(e))],_,"extractMinAndMaxIndexed",null);C([I.filter((...[t])=>!Array.isArray(t))],_,"extractMinAndMax",null)});var _e,fe,k=c(()=>{"use strict";U();te();re();oe();ae();ne();ie();se();le();_e="gpuTransformVertexShader",fe=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
out vec3 outPosition;const mat4 identity=mat4(
vec4(1.0,0.0,0.0,0.0),
vec4(0.0,1.0,0.0,0.0),
vec4(0.0,0.0,1.0,0.0),
vec4(0.0,0.0,0.0,1.0)
);void main(void) {vec3 positionUpdated=position;
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
mat4 finalWorld=identity;
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);outPosition=worldPos.xyz;}`;m.ShadersStore[_e]=fe});var me,Oe,w=c(()=>{"use strict";U();me="gpuTransformPixelShader",Oe=`#version 300 es
void main() {discard;}
`;m.ShadersStore[me]=Oe});var O,Le=c(()=>{$();d();y();g();k();w();O=class t{constructor(e){this._buffers={},this._effects={},this._meshListCounter=0,this._engine=e}processAsync(e){return Array.isArray(e)||(e=[e]),this._meshListCounter=0,this._processMeshList(e),Promise.resolve()}_processMeshList(e){let r=this._engine.getCaps().parallelShaderCompile;this._engine.getCaps().parallelShaderCompile=void 0;for(let o=0;o<e.length;++o){let a=e[o];if(a.getTotalVertices()===0||!a.getVertexBuffer||!a.getVertexBuffer(S.PositionKind))continue;let n,s=[],u=[S.PositionKind];a&&a.useBones&&a.computeBonesUsingShaders&&a.skeleton?(u.push(S.MatricesIndicesKind),u.push(S.MatricesWeightsKind),a.numBoneInfluencers>4&&(u.push(S.MatricesIndicesExtraKind),u.push(S.MatricesWeightsExtraKind)),s.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),s.push("#define BONETEXTURE "+a.skeleton.isUsingTextureForMatrices),s.push("#define BonesPerMesh "+(a.skeleton.bones.length+1))):s.push("#define NUM_BONE_INFLUENCERS 0");let l=a.morphTargetManager?B(a.morphTargetManager,s,u,a,!0,!1,!1,!1,!1):0,A=a.bakedVertexAnimationManager;A&&A.isEnabled&&(s.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),W(u,a,s));let E=s.join(`
`);if(this._effects[E])n=this._effects[E];else{let f={attributes:u,uniformsNames:["boneTextureWidth","mBones","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime"],uniformBuffersNames:[],samplers:["boneSampler","morphTargets","bakedVertexAnimationTexture"],defines:E,fallbacks:null,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:l},maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition"]};n=this._engine.createEffect("gpuTransform",f,this._engine),this._effects[E]=n}this._compute(a,n)}this._engine.getCaps().parallelShaderCompile=r}_compute(e,r){let o=this._engine,a,i=e.getTotalVertices();if(this._buffers[e.uniqueId])a=this._buffers[e.uniqueId];else{let u=new Float32Array(i*3);a=new h(e.getEngine(),u,!0,3),this._buffers[e.uniqueId]=a}r.getEngine().enableEffect(r),e._bindDirect(r,null,!0),X(e,r),b(e,r),e.morphTargetManager&&e.morphTargetManager.isUsingTextureForTargets&&e.morphTargetManager._bind(r);let n=e.bakedVertexAnimationManager;n&&n.isEnabled&&e.bakedVertexAnimationManager?.bind(r,!1);let s=a.getData();if(o.bindTransformFeedbackBuffer(a.getBuffer()),o.setRasterizerState(!1),o.beginTransformFeedback(!0),o.drawArraysType(2,0,i),o.endTransformFeedback(),o.setRasterizerState(!0),o.readTransformFeedbackBuffer(s),o.bindTransformFeedbackBuffer(null),this._meshListCounter===0)e._refreshBoundingInfo(s,null);else{let u=e.getBoundingInfo().boundingBox,l=x(s,0,i);t._Min.copyFrom(u.minimum).minimizeInPlace(l.minimum),t._Max.copyFrom(u.maximum).maximizeInPlace(l.maximum),e._refreshBoundingInfoDirect({minimum:t._Min,maximum:t._Max})}}registerMeshListAsync(e){return Array.isArray(e)||(e=[e]),this._meshList=e,this._meshListCounter=0,Promise.resolve()}processMeshList(){this._meshList.length!==0&&(this._processMeshList(this._meshList),this._meshListCounter++)}fetchResultsForMeshListAsync(){return this._meshListCounter=0,Promise.resolve()}dispose(){for(let e in this._buffers)this._buffers[e].dispose();this._buffers={},this._effects={},this._engine=null}};O._Min=new p;O._Max=new p});export{rt as a,x as b,ot as c,y as d,Me as e,Ce as f,H as g,Ie as h,V as i,He as j,Ve as k,B as l,Ge as m,v as n,ue as o,b as p,Be as q,ve as r,be as s,W as t,X as u,We as v,pe as w,Xe as x,de as y,ye as z,ke as A,Ae as B,we as C,ze as D,Te as E,Ye as F,Pe as G,Se as H,ce as I,Ke as J,qe as K,Qe as L,Ze as M,Re as N,Ne as O,je as P,d as Q,O as R,Le as S};
